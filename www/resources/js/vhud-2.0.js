/*
 * 
 */
new Backbone.Application({name:"app",nameSpace:"visualHUD",scaleFactor:1,ver:"2.0",MAX_BACKGROUND_SIZE:1024*300,allocationMap:{model:"Models",collection:"Collections",controller:"Controllers",view:"Views",viewportViews:"Views.viewport",modalViews:"Views.windows",lib:"Libs",utility:"Utils",widgets:"Widgets"},controllers:["Viewport","HUDManager","KeyboardManager","FocusManager","HistoryManager"],ACTION_CONTACT:"contact.php",ACTION_DOWNLOAD_PRESETS:"download_presets.php",ACTION_DOWNLOAD_HUD:"download.php",messages:{scriptError:"There was an error on this page.",errorReportSuccess:"Thanks, mate. Your report has been sent",noHUDItems:"There are no HUD items yet. C'mon, add some elements first and try again",invalidHUDPreset:"Invalid HUD preset. Aborting...",reportErrorTitle:"Report an application error/bug",editRangesTitle:"Edit {0} color ranges",invalidPresetData:"Application was unable to parse custom HUD data",slowPerformanceProperty:"Depending on your hardware configuration, using {0} may impact your in-game performance and significally lower your FPS.",EMPTY_HUD_WARNING:"Nothing to download, mate. Try to add new items or import custom HUD first.",HUD_ELEMENTS_PARSE_ERROR:"visualHUD was unable to parse <%= count %> HUD element<%= count==1 ? '' : 's' %> because the data is incorrect or currupted",HUD_PARSE_ERROR:"visualHUD was unable to parse custom HUD because the data is incorrect or corrupted",LARGE_IMAGE_WARNING:"Image you are trying to import, are too large (<%= imageSize %>). Please, try another image that is less than <%= maxSize %>",UNSUPPORTED_IMAGE_FORMAT:"Image type you are trying to import is not supported (<%= imageType %>). Try to import images in PNG, JPG or GIF format",UNSUPPORTED_FILE_FORMAT:"File<%= count>1 ? 's' : '' %> you are trying to load <%= count>1 ? 'are' : 'is' %> not supported. To load previously downloaded HUD use *.vhud files.",CONFIRM_APPLICATION_RESET:"Are you sure to reset visualHUD?\nAll settings and stored data will be cleared!",CONFIRM_HUD_OVERWRITE:"Are you sure to overwrite current HUD? All changes will be lost!",AJAX_ERROR:"<%= url %> request returned error:<br /><strong><%= error %></strong>"},initialize:function(){},launch:function(){var a=window.location.hostname,b=window.location.search;this.scaleFactor=this.getModel("ClientSettings").get("scaleFactor");$("body").addClass("scale-factor-"+this.scaleFactor);this.toolTips=new visualHUD.Widgets.ToolTip({delay:500});this.growl=new visualHUD.Widgets.Growl({offset:7});window.onerror=visualHUD.Function.createBuffered(this.applicationErrorHandler,50,this);$(document).ajaxError(visualHUD.Function.bind(function(e,d,f,c){this.ajaxErrorAlert=this.growl.alert({status:"error",title:"Oops.. Something goes wrong ;(",message:_.template(this.messages.AJAX_ERROR,{url:f.url,error:d.status+" "+c})})},this))},applicationErrorHandler:function(f,e,a){var d=$.browser.version;var c=["\n-----------------------\n"];for(var b in $.browser){if(b!="version"){c.push(b)}}c=c.join("/")+" ver."+d+"\n";$.ajax({type:"post",url:visualHUD.ACTION_CONTACT,data:[{name:"name",value:"VisualHUD Automated Reported"},{name:"email",value:"vhud@pk69.com"},{name:"message",value:_.template("Error: <%= errorMsg %>\nURL: <%= url %>\nLine: <%= lineNumber %><%= browserInfo %>",{errorMsg:f,url:e,lineNumber:a,browserInfo:c})}],success:visualHUD.Function.bind(function(){if(this.growl==undefined){return true}var g=(["<p><%= errorMsg %><br />","<%= url %> (line: <%= lineNumber %>)</p>","But no worries, mate, this problem has been already reported."]).join("");$alert=this.growl.alert({status:"error",title:"Oops.. Something goes wrong ;(",message:_.template(g,{errorMsg:f,url:e,lineNumber:a})})},visualHUD)})},confirm:function(a){return new visualHUD.Views.windows.Confirm(a).show()}});visualHUD.Libs.utility={getGuid:function(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())},fontToBoxSize:function(a){return{width:Math.round(104*a),height:Math.round(36*a)}},hexToQLColor:function(g){var f=$.color(g);var e=[];for(var d=0,c=f.rgb.length;d<c;d++){e[d]=f.rgb[d]/255;e[d]=Math.floor(e[d]*100);e[d]=e[d]/100}return e.join(" ")},convertQLColor:function(g){g=g.split(" ");var f=[];for(var d=0,c=g.length;d<c;d++){f[d]=Math.floor(g[d]*255)}var e=$.color(f);return e},getBoxGradients:function(d,f,k){var d=parseInt(d,10);if(d==0){return["none !important"]}var g="rgba(<%= color %>,<%= opacity %>)",n=f.rgb.join(",");var i=[_.template(g,{color:n,opacity:k}),_.template(g,{color:n,opacity:0})],h=["-moz-linear-gradient","-webkit-linear-gradient","linear-gradient","-ms-linear-gradient"],m=[],q=[],j="<%= prefix %>(<%= direction %>,  <%= colorStart %> 0%, <%= colorEnd %> 100%)";switch(d){case 1:m=("top,top,to bottom,top").split(",");break;case 2:m=("bottom,bottom,to top,bottom").split(",");break;case 3:m=("left,left,to right,left").split(",");break;case 4:m=("right,right,to left,right").split(",");break}for(var p=0,o=h.length;p<o;p++){q.push(_.template(j,{prefix:h[p],direction:m[p],colorStart:i[0],colorEnd:i[1]}))}if($.browser.msie){var e=Math.floor(k*255).toString(16);var l=f.hex.replace("#","#"+e);var c=f.hex.replace("#","#00");switch(d){case"0":direction=0;i=[l,l];break;case"1":direction=0;i=[l,c];break;case"2":direction=0;i=[c,l];break;case"3":direction=1;i=[l,c];break;case"4":direction=1;i=[c,l];break}d="progid:DXImageTransform.Microsoft.Gradient(GradientType="+direction+', StartColorStr="'+i[0]+'", EndColorStr="'+i[1]+'")'}return q},getRCornersMarkup:function(g){var j={"3":[[0,50,95],[50,100,100],[95,100,100]],"5":[[0,0,25,70,90],[0,48,100,100,100],[25,100,100,100,100],[70,100,100,100,100],[90,100,100,100,100]],"8":[[0,0,0,0,15,55,80,95],[0,0,0,45,95,100,100,100],[0,0,70,100,100,100,100,100],[0,55,100,100,100,100,100,100],[15,95,100,100,100,100,100,100],[55,100,100,100,100,100,100,100],[80,100,100,100,100,100,100,100],[95,100,100,100,100,100,100,100]]};var c=parseInt(g.borderRadius,10);var p=parseInt(g.opacity,10);var d={topLeft:[0,0],topRight:[0,g.coordinates.width-c],bottomLeft:[g.coordinates.height-c,0],bottomRight:[g.coordinates.height-c,g.coordinates.width-c]};var o=j[c];var f={topLeft:{vertical:1,horizontal:1},topRight:{vertical:1,horizontal:0},bottomLeft:{vertical:0,horizontal:1},bottomRight:{vertical:0,horizontal:0}};var l=function(r){var B=r.direction;var q=r.offset;var E=[];var z,k,t;var C=r.matrix;var u,s;var b=C.length;for(var A in C){A=parseInt(A);u=B.vertical?A:b-1-A;var F=C[u];if(!F){continue}z=q[0]+A;var v=F.length;for(var w in F){w=parseInt(w);s=B.horizontal?w:v-1-w;var D=F[s];if(!D){continue}k=q[1]+w;var a=F[B.horizontal?s-1:s+1];if(a&&a==100){E[E.length-1].width++}else{E.push({top:z,left:k,width:1,height:1,opacity:(p/100)*D})}}}return E};var h=[];for(var e in d){$.merge(h,l({matrix:j[c],offset:d[e],direction:f[e]}))}var i=[c,0,g.coordinates.width-c];for(var n=0,m=3;n<m;n++){h.push({top:n==0?0:c,left:i[n],width:n==0?g.coordinates.width-2*c:c,height:g.coordinates.height-(n==0?0:2*c),opacity:p})}return h}};visualHUD.Function={bind:function(d,c,b,a){if(arguments.length===2){return function(){return d.apply(c,arguments)}}var f=d,e=Array.prototype.slice;return function(){var g=b||arguments;if(a===true){g=e.call(arguments,0);g=g.concat(b)}return f.apply(c||window,g)}},createDelayed:function(e,c,d,b,a){if(d||b){e=visualHUD.Function.bind(e,d,b,a)}return function(){var f=this;return setTimeout(function(){e.apply(f,arguments)},c)}},createBuffered:function(d,a,c,b){return function(){var e;return function(){var h=this,f=b||arguments,g=c||this;if(e){clearTimeout(e);e=null}e=setTimeout(function(){d.apply(g,f)},a)}}()},createThrottled:function(e,b,d){var f,a,c,h,g=function(){e.apply(d||this,c);f=new Date().getTime()};return function(){a=new Date().getTime()-f;c=arguments;clearTimeout(h);if(!f||(a>=b)){g()}else{h=setTimeout(g,b-a)}}}};visualHUD.Libs.itemBuilderMixin={getByType:function(a){return this[a]},getByName:function(a){return this[a]},general:{getRgba:_.template("rgba(<%= color %>,<%= opacity%>)"),updateTextSize:function(b){var a=parseInt(b,10)*visualHUD.scaleFactor,c=visualHUD.Libs.utility.fontToBoxSize(a/100);this.getDOMRefs().textBlock.width(c.width).height(c.height).css("line-height",c.height+"px");this.getDOMRefs().counter.css({"font-size":a+"%"})},updateTextStyle:function(b){var c=this.getDOMRefs().counter.attr("class"),a=/textstyle-[0-9]/;if(a.test(c)){c=c.replace(a,"");c=$.trim(c)}c+=(" textstyle-"+b);this.getDOMRefs().counter.attr("class",c)},updateTextOpacity:function(b){var a=parseInt(b,10);this.getDOMRefs().textBlock.css("opacity",a/100)},updateIconSpacing:function(b){var c=parseInt(b,10)*visualHUD.scaleFactor,a=this.model.get("iconPosition");this.updateIconPositionAndSpacing(a,c)},updateIconPosition:function(b){var c=parseInt(this.model.get("iconSpacing"),10)*visualHUD.scaleFactor,a=b;this.updateIconPositionAndSpacing(a,c)},updateIconPositionAndSpacing:function(d,i){var h={left:"margin-right",top:"margin-bottom",right:"margin-left",bottom:"margin-top"},g=[this.getDOMRefs().textBlock,this.getDOMRefs().iconBlock];this.getDOMRefs().iconBlock.css("margin","auto").css(h[d],i+"px");if(d.match(/left|top/gi)){g=[this.getDOMRefs().iconBlock,this.getDOMRefs().textBlock]}var f=d=="left"||d=="right"?"removeClass":"addClass";this.$el[f]("icon-top");for(var e=0,c=g.length;e<c;e++){g[e].appendTo(this.$el)}},updateIconOpacity:function(b){var a=parseInt(b,10);this.getDOMRefs().iconBlock.css("opacity",a/100)},updateIconSize:function(b){var a=parseInt(b,10)*visualHUD.scaleFactor;this.getDOMRefs().icon.css({});this.getDOMRefs().iconBlock.css({width:a+"px",height:a+"px",display:a==0?"none":""})},updateIconStyle:function(c){var a=parseInt(c,10),b=this.getIconOptions();iconData=b[a];this.getDOMRefs().icon.attr("src",iconData.url)},updateTextColorByStatus:function(d,b){var a=parseInt(d,10),c=this.model.get("textColor");_.each(b,function(e){if(a>=e.range[0]&&a<=e.range[1]){c=e.color;return{}}},this);this.getDOMRefs().counter.css({color:"#"+c})},updateTextColor:function(a){this.getDOMRefs().counter.css({color:"#"+a})},updateText:function(b){this.getDOMRefs().counter.text(b);var a=this.model.get("colorRanges");if(a!=null){this.updateTextColorByStatus(b,a)}},updateColorRanges:function(a){var b=this.model.get("text");this.updateTextColorByStatus(b,a)}},timer:{updateTextSize:function(a){visualHUD.Libs.itemBuilderMixin.getByType("general").updateTextSize.call(this,a);this.getDOMRefs().textBlock.width("auto")}},medal:{updateIconStyle:function(a){visualHUD.Libs.itemBuilderMixin.getByType("general").updateIconStyle.apply(this,arguments);var c=parseInt(this.model.get("iconStyle"),10);var b=this.model.get("text");this.updateText(b)},updateText:function(a){var b=parseInt(this.model.get("iconStyle"),10);if(b==0&&a.match(/\%$/)==null){a+="%"}if(b>0){a=a.replace("%","")}this.getDOMRefs().counter.text(a)},updateTextSize:function(a){visualHUD.Libs.itemBuilderMixin.getByType("timer").updateTextSize.apply(this,arguments)}},powerupIndicator:{updateTextSize:function(a){visualHUD.Libs.itemBuilderMixin.getByType("timer").updateTextSize.apply(this,arguments)},updateIconSpacing:function(c){var b=parseInt(c,10);var a=this.$el.find("div.powerup-item:last").eq(0);a.css("margin","auto");if(!this.model.get("singlePowerup")){a.css("margin-"+this.model.get("iconPosition"),b*visualHUD.scaleFactor)}},updateIconPosition:function(d){var e=this.$el.attr("class").toLowerCase(),c=/stack-[a-z]/,b=parseInt(this.model.get("iconSize"),10),a=parseInt(this.model.get("iconSpacing"),10),f=visualHUD.Libs.utility.fontToBoxSize(b/100);if(c.test(e)){e=e.replace(c,"");e=$.trim(e)}e+=(" stack-"+d);this.$el.attr("class",e);this.updateIconSpacing(a)},updateSinglePowerup:function(b){var a=b?"addClass":"removeClass";this.$el[a]("single-powerup")}},accuracyIndicator:{updateTextSize:function(c){visualHUD.Libs.itemBuilderMixin.getByType("general").updateTextSize.call(this,c);var a=parseInt(c,10)/100;var b=Math.round(128*a)*visualHUD.scaleFactor;this.getDOMRefs().textBlock.width(b)},updateText:function(a){this.getDOMRefs().counter.text(a+"%")}},skillIndicator:{updateTextSize:function(c){var a=parseInt(c,10)*visualHUD.scaleFactor;var d=visualHUD.Libs.utility.fontToBoxSize(a/100);this.getDOMRefs().textBlock.height(d.height).css("line-height",d.height+"px");this.$el.height(d.height).css("line-height",d.height+"px");var b={"line-height":d.height+"px","font-size":a+"%"};this.getDOMRefs().counter.css(b);this.getDOMRefs().templateText.css(b)},updateTextStyle:function(b){var c=this.getDOMRefs().counter.attr("class");var a=/textstyle-[0-9]/;if(a.test(c)){c=c.replace(a,"");c=$.trim(c)}c+=(" textstyle-"+b);this.getDOMRefs().counter.attr("class",c)},updateTemplate:function(a){this.getDOMRefs().templateText.html(a+(a.length?":&nbsp;":""))},updateTextColor:function(a){this.getDOMRefs().templateText.css({color:"#"+a})}},chatArea:{updatePadding:function(a){var b=parseInt(a,10)*visualHUD.scaleFactor;this.getDOMRefs().chatList.css({padding:b})},updateShowChat:function(b){var a=(b?"add":"remove")+"Class";this.$el[a]("chat-visible");a=(b?"remove":"add")+"Class";this.$el[a]("chat-invisible")},updateWidth:function(c){var b=parseInt(c,10),a=this.model.get("height"),d=this.model.get("padding");this.updateDimensions(b,a,d)},updateHeight:function(c){var a=parseInt(c,10),b=this.model.get("width"),d=this.model.get("padding");this.updateDimensions(b,a,d)},updatePadding:function(c){var d=parseInt(c,10),b=this.model.get("width"),a=this.model.get("height");this.updateDimensions(b,a,d)},updateDimensions:function(e,a,g){e*=visualHUD.scaleFactor;a*=visualHUD.scaleFactor;g*=visualHUD.scaleFactor;var f=2*g+this.model.get("minHeight")*visualHUD.scaleFactor;var d=2*g+this.model.get("minWidth")*visualHUD.scaleFactor;var b=Math.max(d,e);var c=Math.max(f,a);b=this.model.get("maxWidth")?Math.min(this.model.get("maxWidth")*visualHUD.scaleFactor,b):b;this.$el.width(b);c=this.model.get("maxHeight")?Math.min(this.model.get("maxHeight")*visualHUD.scaleFactor,c):c;this.$el.height(c);this.getDOMRefs().chatList.css("margin",g)}},scoreBox:{updateIconStyle:function(c){var d=this.$el.attr("class");var a=d;var b=/style-[0-9]/;if(b.test(d)){a=d.replace(b,"");a=$.trim(a)}a+=(" style-"+c);this.$el.attr("class",a)},updateIconSpacing:function(b){var c=parseInt(b,10)*visualHUD.scaleFactor,a=this.model.get("scoreboxLayout");this.updateLayoutAndSpacing(a,c)},updateScoreboxLayout:function(b){var c=parseInt(this.model.get("iconSpacing"),10)*visualHUD.scaleFactor,a=b;this.updateLayoutAndSpacing(a,c)},updateLayoutAndSpacing:function(e,g){var b={vertical:"margin-top",horizontal:"margin-left"};var f={vertical:"scorebox-vertical",horizontal:"scorebox-horizontal"};for(var a in f){var d=a==e?"addClass":"removeClass";this.$el[d](f[a])}var c=this.getDOMRefs().iconBlock.eq(1);c.css("margin",0).css(b[e],g+"px")},updateScoreboxMode:function(d){var c={ffa:"ffa-score",tdm:"team-score"};for(var a in c){var b=a==d?"addClass":"removeClass";this.$el[b](c[a])}}},bar:{updateBarDirection:function(b){var c=parseInt(b,10);var a=["ltr-bar","rtl-bar"];_.each(a,function(f,d){var e=d==c?"addClass":"removeClass";this.$el[e](a[d])},this)},updateWidth:function(c){var b=parseInt(c,10),a=this.model.get("height"),d=this.model.get("padding");this.updateBarDimensions(b,a,d)},updateHeight:function(c){var a=parseInt(c,10),b=this.model.get("width"),d=this.model.get("padding");this.updateBarDimensions(b,a,d)},updatePadding:function(c){var d=parseInt(c,10),b=this.model.get("width"),a=this.model.get("height");this.updateBarDimensions(b,a,d)},updateBarDimensions:function(e,a,g){e*=visualHUD.scaleFactor;a*=visualHUD.scaleFactor;g*=visualHUD.scaleFactor;var f=2*g+this.model.get("minHeight")*visualHUD.scaleFactor;var d=2*g+this.model.get("minWidth")*visualHUD.scaleFactor;var b=Math.max(d,e);var c=Math.max(f,a);b=this.model.get("maxWidth")?Math.min(this.model.get("maxWidth")*visualHUD.scaleFactor,b):b;this.$el.width(b);c=this.model.get("maxHeight")?Math.min(this.model.get("maxHeight")*visualHUD.scaleFactor,c):c;this.$el.height(c);this.getDOMRefs().box.css("padding",g)},updateText:function(e){var d=parseInt(e,10);var c={h100:d>100?100:d,h200:d>100?d-100:0};for(var b in c){this.getDOMRefs()[b].css("width",c[b]+"%")}var a=this.model.get("colorRanges");if(a!=null){this.updateTextColorByStatus(d,a)}},updateColorRanges:function(a){var b=parseInt(this.model.get("text"),10);this.updateTextColorByStatus(b,a)},updateTextColorByStatus:function(d,a){var c=parseInt(this.model.get("barsOpacity"),10),b=null;_.each(a,function(e){if(d<=100&&d>=e.range[0]&&d<=e.range[1]){b=$.color("#"+e.color);this.paintBarElement(this.getDOMRefs().h100,b,c)}else{if(d>=e.range[0]&&d<=e.range[1]){b=$.color("#"+e.color);(d>100)&&this.paintBarElement(this.getDOMRefs().h200,b,c)}if(100>=e.range[0]&&100<=e.range[1]){b=$.color("#"+e.color);this.paintBarElement(this.getDOMRefs().h100,b,c)}}},this)},updateBarsOpacity:function(c){var a=this.model.get("colorRanges");var b=parseInt(this.model.get("text"),10);if(a!=null){this.updateTextColorByStatus(b,a)}},paintBarElement:function(c,a,b){c.css("background",this.getRgba({color:a.rgb.join(","),opacity:b/100}))},updateColor:function(c){var a=$.color("#"+c);var b=parseInt(this.model.get("opacity"),10);this.paintBarElement(this.getDOMRefs().box,a,b)},updateOpacity:function(c){var b=parseInt(c,10);var a=$.color("#"+this.model.get("color"));this.paintBarElement(this.getDOMRefs().box,a,b)}},rect:{updateWidth:function(c){var b=parseInt(c,10),a=this.model.get("height");this.updateDimensions(b,a)},updateHeight:function(c){var a=parseInt(c,10),b=this.model.get("width");this.updateDimensions(b,a)},updateDimensions:function(e,a){e*=visualHUD.scaleFactor;a*=visualHUD.scaleFactor;var f=this.model.get("minHeight")*visualHUD.scaleFactor;var d=this.model.get("minWidth")*visualHUD.scaleFactor;var b=Math.max(d,e);var c=Math.max(f,a);b=this.model.get("maxWidth")?Math.min(this.model.get("maxWidth")*visualHUD.scaleFactor,b):b;this.$el.width(b);c=this.model.get("maxHeight")?Math.min(this.model.get("maxHeight")*visualHUD.scaleFactor,c):c;this.$el.height(c)},updateColor:function(a){this.updateBoxStyle()},updateOpacity:function(a){this.updateBoxStyle()},updateBorderRadius:function(c){var a=parseInt(c,10);var d=this.getDOMRefs().box.attr("class"),b=/rbox-[0-9]/;if(b.test(d)){d=d.replace(b,"");d=$.trim(d)}d+=(" rbox-"+a);this.getDOMRefs().box.attr("class",d);if(a>0){this.model.set("boxStyle",0,{silent:true});this.getForm().setValues({boxStyle:0},{silent:true});this.updateBoxStyle(0)}},updateBoxStyle:function(){var c=parseInt(this.model.get("boxStyle"),10);var a=$.color("#"+this.model.get("color"));var b=this.model.get("opacity")/100;var d=c>0&&parseInt(this.model.get("borderRadius"),10)==0;if(d){this.getDOMRefs().box.css("background",a.hex);_.each(visualHUD.Libs.utility.getBoxGradients(c,a,b),function(e){this.getDOMRefs().box.css("background",e)},this)}else{this.getDOMRefs().box.css("background",this.getRgba({color:a.rgb.join(","),opacity:b}))}if(c>0){this.model.set("borderRadius",0,{silent:true});this.getForm().setValues({borderRadius:0},{silent:true});this.updateBorderRadius(0)}}},obits:{updateTextSize:function(a){},updateTextStyle:function(a){},updateTextOpacity:function(a){},updateIconPosition:function(a,b){},updateIconOpacity:function(a){},updateIconSize:function(a){},updateIconStyle:function(a){},updateIconSpacing:function(a){},updateTextColor:function(a){},updateTeamColors:function(a){},updateColorRanges:function(a){},updateText:function(a){},updateBorderRadius:function(a){},updateBoxStyle:function(a){},updateTemplate:function(a){},updatePowerupView:function(a){},updatePadding:function(a){},updateToggleChat:function(a){},updateScoreboxLayout:function(a){}}};visualHUD.Libs.layersManager={alignItem:function(e,d,c){var b=e.$el,a={};switch(c){case"top":a={top:d[0].top};break;case"bottom":a={top:Math.round(d[0].top+d[0].height-d[1].height)};break;case"vertical":a={top:Math.round(d[0].top+(d[0].height-d[1].height)/2)};break;case"left":a={left:d[0].left};break;case"right":a={left:Math.round(d[0].left+d[0].width-d[1].width)};break;case"horizontal":a={left:Math.round(d[0].left+(d[0].width-d[1].width)/2)};break}b.css(a);return a},alignEdges:function(h,f){var g=h.getSelection(),i=g.length>1&&g[0].getGroup()!=null;boxes=[];if(g.length==1||i){var e=g[0];boxes.push({top:0,left:0,width:h.$el.width(),height:h.$el.height()},e.$el.coordinates(true,false));if(i==false){this.alignItem(g[0],boxes,f)}else{console.info("Could not align grouped items yet :(")}}else{for(var d=0,c=g.length;d<c;d++){boxes.push(g[d].$el.coordinates(true,false));if(d>0){this.alignItem(g[d],[boxes[0],boxes[d]],f)}}}},arrangeLayers:function(g,d){var c=g.getSelection();if(c.length==0){return}var b=c[0].$el;var f=g.$canvas;var h={"bring-front":{element:f,fn:"appendTo"},"send-back":{element:f,fn:"prependTo"},"bring-forward":{element:b.next(),fn:"insertAfter"},"send-backward":{element:b.prev(),fn:"insertBefore"}};var e;var a=h[d];if(a.element.length&&a.element[0]!=b[0]){b[a.fn](a.element)}}};visualHUD.Libs.canvasDragInterface={offsets:[],getView:function(){return this.options.view},setMode:function(a){switch(a){case"move":this.setOptions({bodyDragClass:"drag",onbeforestart:this.beforeStart,onstart:this.startMoveElement,ondrag:null,ondrop:null});break;case"select":this.setOptions({bodyDragClass:"drag-select",onbeforestart:null,onstart:this.startDragSelect,ondrag:null,ondrop:null});break;case"resize":this.setOptions({bodyDragClass:"resize",onbeforestart:null,onstart:this.startResizeBox,ondrag:null,ondrop:null});break;case"draw":this.setOptions({bodyDragClass:"draw",onbeforestart:this.beforeStart,onstart:this.startDrawRect,ondrag:this.drawRect,ondrop:this.drawRectDrop});break;default:this.setOptions({bodyDragClass:"",onbeforestart:null,onstart:null,ondrag:null,ondrop:null})}return this},beforeStart:function(a,b,c){var d=this.currentElement.offsetParent();this.offsets=[];this.limits={top:0,left:0,right:d.width(),bottom:d.height()}},setDragHandle:function(a){this.resizeHandle=a;return this},startDrawRect:function(b,a){this.currentElement=this.drawBox.clone().css({top:Math.round(this.mouse.y),left:Math.round(this.mouse.x)}).appendTo(visualHUD.application.hudElementsWrap);this.mode="drawRect"},drawRect:function(d,a,f,g){if(this.options.grid){this.mouse.x-=this.mouse.x%this.options.grid;this.mouse.y-=this.mouse.y%this.options.grid;g.x-=g.x%this.options.grid;g.y-=g.y%this.options.grid}var i=Math.abs(this.mouse.x-g.x);var e=Math.abs(this.mouse.y-g.y);var j=Math.min(this.mouse.y,g.y)-this.limits.top;var c=Math.min(this.mouse.x,g.x)-this.limits.left;if(j<0){j=0;e=this.mouse.y-this.limits.top}else{e=g.y>this.limits.bottom?this.limits.bottom-this.mouse.y:e}if(c<0){c=0;i=this.mouse.x-this.limits.left}else{i=g.x>this.limits.right?this.limits.right-this.mouse.x:i}if(this.options.grid){c-=c%this.options.grid;j-=j%this.options.grid}var b={width:i,height:e,top:Math.round(j),left:Math.round(c)};this.currentElement.css(b);return b},drawRectDrop:function(){var a={name:"rectangleBox",itemType:"rect",label:"Rectangle box",cssClass:"lib-element-rect"};visualHUD.constructor.fn.createRect(a,this.currentElement);this.currentElement.trigger("click");_data=this.currentElement.data("HUDItem")},startDragSelect:function(b,c,a){var f=this;this.rubberBox=this.rubberBox||$("<div />").addClass("rubber-box");this.currentElement=this.rubberBox.css({width:1,height:1,top:Math.round(this.mouse.y),left:Math.round(this.mouse.x)}).appendTo(this.getView().$canvas);var d=this.getView().$canvas.find("div.hud-item");var e=[];d.each(function(){var g=$(this);e.push({element:g,coordinates:g.coordinates(true,false)})});this.limits=this.getView().getCanvasOffset();this.getView().deselect();this.elementCoordinatesCache=e;this.setOptions({ondrag:this.dragSelect,ondrop:this.dragSelectDrop})},dragSelect:function(h,c,i,j){var e=this.drawRect.apply(this,arguments);e.right=e.left+e.width;e.bottom=e.top+e.height;var g,d;for(var l=0,k=this.elementCoordinatesCache.length;l<k;l++){g=this.elementCoordinatesCache[l];var f=g.element;var m=g.coordinates;var d=e.right>m.left&&e.left<m.right&&e.bottom>m.top&&e.top<m.bottom?"addClass":"removeClass";f[d]("selected")}},dragSelectDrop:function(c,d){var a=this.getView();this.rubberBox&&this.rubberBox.remove();this.currentElement=null;this.elementCoordinatesCache=null;var b=a.$canvas.find("div.selected");window.setTimeout(function(){b.each(function(){a.select(this,true)})},20);this.setMode(null);return false},startResizeBox:function(b,c,a){this.resizeDirection=this.currentElement.data("resizedirection");this.currentElement=this.currentElement.closest("div.hud-item");this.limits=this.getView().getCanvasOffset();this.positionCache=null;this.setOptions({ondrag:this.resizeBox,ondrop:this.resizeBoxDrop})},resizeBox:function(e,c,g,i){if(this.options.grid){i.x-=i.x%this.options.grid;i.y-=i.y%this.options.grid}var g=this.positionCache=this.positionCache||this.currentElement.position();var m=g.top;var d=g.left;var k=this.positionCache.width||this.currentElement.width();var f=this.positionCache.height||this.currentElement.height();var j=g.top+f;var a=g.left+k;if(this.resizeDirection=="n"||this.resizeDirection=="ne"||this.resizeDirection=="nw"){m=Math.max(i.y-this.limits.top,0);f=Math.max(j-m,1);if(f==1){m=j-f}}if(this.resizeDirection=="w"||this.resizeDirection=="nw"||this.resizeDirection=="sw"){d=Math.max(i.x-this.limits.left,0);k=Math.max(a-d,1);if(k==1){d=a-k}}if(this.resizeDirection=="e"||this.resizeDirection=="ne"||this.resizeDirection=="se"){k=i.x-g.left-this.limits.left;k=i.x>this.limits.right?this.limits.right-this.limits.left-g.left:k}if(this.resizeDirection=="s"||this.resizeDirection=="se"||this.resizeDirection=="sw"){f=i.y-g.top-this.limits.top;f=i.y>this.limits.bottom?this.limits.bottom-this.limits.top-g.top:f}if(this.options.grid){k-=k%this.options.grid;f-=f%this.options.grid}g=this.positionCache={width:Math.max(1,k),height:Math.max(1,f),top:m,left:d};this.currentElement.css(g)},resizeBoxDrop:function(){var a=this.currentElement.data("HUDItem");this.positionCache.height=Math.max(a.model.get("minHeight")*visualHUD.scaleFactor+a.model.get("padding")*2*visualHUD.scaleFactor,this.positionCache.height);this.positionCache.width=Math.max(a.model.get("minWidth")*visualHUD.scaleFactor+a.model.get("padding")*2*visualHUD.scaleFactor,this.positionCache.width);a.update({coordinates:{top:Math.round(this.positionCache.top/visualHUD.scaleFactor),left:Math.round(this.positionCache.left/visualHUD.scaleFactor),width:Math.round(this.positionCache.width/visualHUD.scaleFactor),height:Math.round(this.positionCache.height/visualHUD.scaleFactor)},width:this.positionCache.width/visualHUD.scaleFactor,height:this.positionCache.height/visualHUD.scaleFactor});this.setMode(null);this.positionCache=null},startMoveElement:function(g,d,f){this.setOptions({ondrag:this.moveElement,ondrop:this.moveElementDrop});this.currentElement=this.currentElement.data("HUDItem");this.currentElement.$el.addClass("drag-start");this.slaveElements=[];this.offsets=[];this.drawLine=false;var i=this.getView();i.select(this.currentElement,i.isMultilect());var l=i.getSelection(),e=false;if(l.length>1){for(var k=0,j=l.length;k<j;k++){e=l[k].$el.get(0)==this.currentElement.$el.get(0);if(e==false){this.slaveElements.push(l[k])}}var c=this.currentElement.$el.position();for(k=0,j=this.slaveElements.length;k<j;k++){var h=this.slaveElements[k].$el.position();this.offsets.push({top:c.top-h.top,left:c.left-h.left})}}},moveElement:function(h,i,d,f){var g=this.currentElement.checkPosition(d);this.currentElement.$el.css(g);var j;for(var e=0,c=this.slaveElements.length;e<c;e++){j=this.slaveElements[e].checkPosition({top:g.top-this.offsets[e].top,left:g.left-this.offsets[e].left});this.slaveElements[e].$el.css(j)}},moveElementDrop:function(a,b,c){this.currentElement.$el.removeClass("drag-start");this.getView().trigger("drop.move",[this.currentElement])}};visualHUD.Libs.selectionManagerInterface={selection:[],_deselectBinded:false,_selectionDisabled:false,select:function(d,a){var b;this._multiselected=a||false;if(d instanceof visualHUD.Views.HUDItem){b=d}else{b=$(d).data("HUDItem")}var c=b.getGroup();var e=this.isSelected(b);if(this._selectionDisabled==false){if(a==false){this.deselect()}if(this.isSelected(b)==false){this.selection.push(b);b.$el.addClass("selected")}(c==null)&&this.trigger("selectionchange",[this,this.getSelection()]);if(this._deselectBinded==false){$("body").bind("click.deselect",visualHUD.Function.bind(this.clickDeselect,this));this._deselectBinded=true}}if(c){this.selectByGroup(c)}},isSelected:function(a){return _.include(this.selection,a)},deselect:function(){_.each(this.selection,function(a){a.$el.removeClass("selected")});this.selection.length=0;this.trigger("selectionchange",[this,this.getSelection()]);if(this._deselectBinded==true){$("body").unbind("click.deselect");this._deselectBinded=false}this._multiselected=false},selectAll:function(){var a=this;this.$el.find("div."+visualHUD.Views.HUDItem.prototype.className).each(function(){a.select(this,true)})},selectByGroup:function(b){var a=this;this.$el.find("div."+visualHUD.Views.HUDItem.prototype.className).each(function(){var c=$(this).data("HUDItem"),d=c.getGroup(),e=_.include(a.selection,c);if(d==b&&e==false){a.selection.push(c);c.$el.addClass("selected")}});this.trigger("selectionchange",[this,this.getSelection()])},getSelection:function(){return this.selection},disableSelection:function(){this._selectionDisabled=true},enableSelection:function(){this._selectionDisabled=false},isMultilect:function(){return this._multiselected},clickDeselect:function(b){var d=$(b.target);var a=d.closest("div."+visualHUD.Views.HUDItem.prototype.className,this.$el);var c=d.closest(".vh-viewport-sidebar",document.body);if(a.length==0&&c.length==0){this.deselect()}}};visualHUD.Libs.formControlsBuilder={cache:{},getDefaultsByType:function(a){return this.controlDefaults[a]},getTemplateByType:function(a){return this.controlTemplates[a].join("")},buildForm:function(b){var a=document.createDocumentFragment();if(_.isArray(b)==false){b=[b]}_.each(b,function(c){var d=this.createElementByType(c);a.appendChild(d.get(0));if(c.items!=undefined){var e=this.buildForm(c.items);d.get(0).appendChild(e)}},this);return a},createElementByType:function(a){var c="create"+a.type.charAt(0).toUpperCase()+a.type.substring(1);var b=this[c];if(_.isFunction(b)){return b.apply(this,arguments)}else{return this.createFormControl(a)}},controlDefaults:{container:{cssClass:"",id:"",wrap:false,hint:null},form:{cssClass:"",id:"",action:"",method:"get",wrap:false,hint:null},fieldset:{label:"Fieldset",wrap:false,hint:null},toolbar:{cssClass:"",wrap:false},textbox:{size:"",label:"Textbox",name:"textbox",inputType:"text",value:"",maxlength:"",placeholder:"",hint:null,wrap:true,required:false},fileInput:{size:"",label:"Fileinput",noFileMessage:"No file selected",text:"Browse...",name:"file",value:"",accept:"*",multiple:false,maxlength:"",hint:null,wrap:true},textarea:{rows:2,cols:20,value:"",wrap:true,hint:null,required:false,name:"textarea"},rangeInput:{value:0,name:"rangeinput",hint:null,wrap:true},checkbox:{type:"checkbox",hint:null,label:null,tooltip:null,checked:false,name:"checkbox",value:"on",boxLabel:"Checkbox",wrap:true},checkboxGroup:{wrap:true,hint:null},radiobutton:{type:"radiobutton",hint:null,label:null,tooltip:null,checked:false,name:"radiobutton",value:"on",boxLabel:"Radiobutton",wrap:true},radiobuttonGroup:{wrap:true,hint:null},select:{width:null,value:0,name:"select",hint:null,wrap:true,displayField:"name",valueField:"id",options:{}},button:{name:"",role:"",action:"button",value:"",cssClass:"",tooltip:"",icon:"",text:"Button",wrap:false,hint:null},alignControl:{label:"Align",hint:null,wrap:true},arrangeControl:{label:"Arrange",hint:null,wrap:true},groupActionsControl:{label:"Actions",hint:null,wrap:true},colorPicker:{value:"FFFFFF",name:"color",hint:null,wrap:true}},controlTemplates:{container:["<div></div>"],form:['<form class="<%= cssClass %>" id="<%= id %>" action="<%= action %>" method="<%= method %>">'],toolbar:['<div class="form-toolbar <%= cssClass %> clearfloat"></div>'],textbox:['<input type="<%= inputType %>" size="<%= size %>" name="<%= name %>" value="<%= value %>" placeholder="<%= placeholder %>" maxlength="<%= maxlength %>" <%= required ? \'required="required"\' : \'\' %>  />'],textarea:['<textarea name="<%= name %>" rows="<%= rows %>" cols="<%= cols %>" <%= required ? \'required="required"\' : \'\' %>><%= value %></textarea>'],fieldset:["<fieldset>","<legend><%= label %></legend>","</fieldset>"],fileInput:['<span class="file-input">','<span class="btn <%= cssClass %>"><span><%= text %></span><input type="file" name="<%= name %>" accept="<%= accept %>" <%= multiple ? \'multiple\' : \'\' %> /></span>','<span class="file-name"><%= noFileMessage %></span>',"</span>"],rangeInput:['<div class="slider"><div class="progress"></div><input type="button" class="handle" /></div>','<input type="text" size="8" maxlength="3" value="<%= value %>" class="range range-input" name="<%= name %>"  />'],checkbox:['<label class="check-label"><input type="checkbox" name="<%= name %>" value="<%= value %>" <%= checked ? \'checked="checked"\' : \'\' %>"><span class="box-label" data-tooltip="<%= tooltip %>"><%= boxLabel %></span></label>'],radiobutton:['<label class="check-label"><input type="radio" name="<%= name %>" value="<%= value %>"  <%= checked ? \'checked="checked"\' : \'\' %>"><span class="box-label" data-tooltip="<%= tooltip %>"><%= boxLabel %></span></label>'],select:['<span class="styled-select w-carret" <% if(width) { %>style="width:<%= width %>"<% }; %>><span class="select-value"></span><select type="text" name="<%= name %>" value="<%= value %>"><%= options %></select></span>'],button:['<button name="<%= name %>" type="<%= action %>" value="<%= value %>" class="<%= cssClass %>" data-tooltip="<%= tooltip %>"><span class="<%= icon %>"><%= text %></span></button>'],alignControl:['<ul class="library-items align-controls icons-24px clearfloat">','<li class="align-top" data-action="top" data-tooltip="Align top edges"><span class="icon"></span><span class="item-name">Top edges</span></li>','<li class="align-vertical" data-action="vertical" data-tooltip="Align vertical centers"><span class="icon"></span><span class="item-name">Vertical centers</span></li>','<li class="align-bottom" data-action="bottom" data-tooltip="Align bottom edges"><span class="icon"></span><span class="item-name">Bottom edges</span></li>','<li class="align-left" data-action="left" data-tooltip="Align left edges"><span class="icon"></span><span class="item-name">Left edges</span></li>','<li class="align-horizontal" data-action="horizontal" data-tooltip="Align horizontal centers"><span class="icon"></span><span class="item-name">Horizontal centers</span></li>','<li class="align-right" data-action="right" data-tooltip="Align right edges"><span class="icon"></span><span class="item-name">Right edges</span></li>',"</ul>"],arrangeControl:['<ul class="library-items arrange-controls icons-24px clearfloat">','<li class="bring-front" data-action="bring-front" data-tooltip="Bring to front <small>(CTRL + SHIFT + UP)</small>"><span class="icon"></span><span class="item-name">Bring to front <small>(CTRL + SHIFT + UP)</small></span></li>','<li class="send-back" data-action="send-back" data-tooltip="Send to back <small>(CTRL + SHIFT + DOWN)</small>"><span class="icon"></span><span class="item-name">Send to back <small>(CTRL + SHIFT + DOWN)</small></span></li>','<li class="bring-forward" data-action="bring-forward" data-tooltip="Bring forward <small>(CTRL + UP)</small>"><span class="icon"></span><span class="item-name">Bring forward <small>(CTRL + UP)</small></span></li>','<li class="send-backward" data-action="send-backward" data-tooltip="Send backward <small>(CTRL + DOWN)</small>"><span class="icon"></span><span class="item-name">Send backward <small>(CTRL + DOWN)</small></span></li>',"</ul>"],groupActionsControl:['<ul class="library-items group-action-controls icons-24px clearfloat">','<li class="delete" data-action="delete-selected" data-tooltip="Delete selected items"></li>','<li class="group" data-action="group-selected" data-tooltip="Group/ungroup selected items"></li>',"</ul>"],colorPicker:['<input type="text" size="6" name="<%= name %>" value="<%= value %>" maxlength="6" class="color-input"  />','<div class="color-picker-box" style="background-color: #<%= value %>; "></div>']},baseTemplate:["<span class=\"f-label <%= label ? '' : 'hidden' %>\"><%= label %></span>",'<span class="f-inputs">',"{markup}","</span>",'<% if(hint) { %><div class="f-hint"><%= hint %></div><% }; %>'],getBaseElement:function(a){var b=$('<div class="f-row" />');b.addClass(a.cssClass||"").attr("id",a.id||"").addClass(a.required?"reqired-field":"");return b},getBaseMarkup:function(a){var b=this.baseTemplate.join("").replace(/{markup}/gi,a);return b},createFormControl:function(b,a){var a=a||this.getTemplateByType(b.type);var f=this.getDefaultsByType(b.type);var b=_.extend({},f,b);var e=b.wrap?this.getBaseMarkup(a):a;var d=_.template(e,b);var c=b.wrap?this.getBaseElement(b).html(d):$(d);return c},createContainer:function(a){var c=$("<div />");var b=["type","items"];var d={cssClass:"class"};var e=_.extend({},a);_.each(b,function(f){delete e[f]});_.each(d,function(g,f){e[g]=e[f];delete e[f]});c.attr(e);if(a.html){c.html(a.html)}return c},createComponent:function(b){var d=Backbone.resolveNamespace(b.constructorName),a=new d(b),c=a.$el;c.data("component",a);return c},createRangeInput:function(b){var d={precision:false,keyboard:false,progress:true,sliderSize:160,handleSize:12};var c=this.createFormControl(b);var a=c.find("input.range-input").rangeinput(_.extend(d,b));return c},createCheckboxGroup:function(a){return this.createChecksGroup("checkbox",a)},createRadiobuttonGroup:function(a){return this.createChecksGroup("radiobutton",a)},createChecksGroup:function(e,c){var d=this.getTemplateByType(e),b=this.getDefaultsByType(e),a=[];c.cssClass=e+"-group layout-"+(c.layout||"");_.each(c.options,function(g){var f=_.extend({},b,g);a.push(_.template(d,f))},this);return this.createFormControl(c,a.join(""))},createSelectOptionsMapFromCollection:function(c,a){var b={};c.each(function(d){b[d.get(a.valueField)]=d.get(a.displayField)});return b},generateSelectOptionsFromMap:function(b,d){var c='<option value="<%= value %>"><%= label %></option>';var a=['<optgroup label="<%= label %>">',"</optgroup>"];_.each(b,function(f,e){if($.isPlainObject(f)){d.push(_.template(a[0],{label:e}));this.generateSelectOptionsFromMap(f,d);d.push(a[1])}else{d.push(_.template(c,{value:e,label:f}))}},this);return d.join("")},createSelect:function(c){if(c.collection){c.options=this.createSelectOptionsMapFromCollection(c.collection,c)}c.options=this.generateSelectOptionsFromMap(c.options,[]);var d=this.createFormControl(c),a=d.find("select"),e=a.parent().find(".select-value");if(c.value){a.val(c.value)}else{a.attr("selectedIndex",0)}var b=a.get(0);e.text($(b[b.selectedIndex]).text());a.on("change",function(){var f=$(this[this.selectedIndex]).text();e.text(f)});a.on("focus",function(){a.parent().addClass("focused")});a.on("blur",function(){a.parent().removeClass("focused")});if(c.collection){c.collection.on("all",function(){var f=this.createSelectOptionsMapFromCollection(c.collection,c);f=this.generateSelectOptionsFromMap(f,[]);a.html(f)},this)}return d},createButton:function(a){a.cssClass=a.cssClass||"";a.cssClass+=a.role?" button-"+a.role:"";a.icon=a.icon?"w-icon icon-"+a.icon:"";return this.createFormControl(a)},createFileInput:function(c){c.cssClass+=c.role?" button-"+c.role:"";var d=this.createFormControl(c);var a=d.find("input[type=file]");var b=d.find("span.file-name");var e=this.getDefaultsByType(c.type);c=_.extend({},e,c);a.bind("change",function(){var f=$(this).val(),g=f.split(/\\/).pop();b.text(g||c.noFileMessage)});return d},createColorRange:function(b){var d=(["<% _.each(ranges, function(range, idx) { %>",'<div class="f-row">','<span class="f-label"><%= range.name %></span>','<span class="f-inputs">','<span class="color-range-inputs mr-10">','<input type="text" size="3" name="colorRange_<%= idx %>_range_0" value="<%= range.range[0] %>" maxlength="3" class="color-range-input mr-5">','<input type="text" size="3" name="colorRange_<%= idx %>_range_1" value="<%= range.range[1] %>" maxlength="3" class="color-range-input mr-5">',"</span>",'<input type="text" size="6" name="colorRange_<%= idx %>_color" value="<%= range.color %>" maxlength="6" class="color-input" />','<div class="color-picker-box" style="background-color: #<%= range.color %>; "></div>',"</span>","</div>","<% }); %>"]).join("");var c=$("<div />").html(_.template(d,b));var e=c.find("input.color-range-input");var a=false;c.delegate("input[type=text]","change",function(h){if(a){$(this).closest("form").trigger(h);a=false;return false}var l=$(this),g=e.index(this),k=(g+1)%2==0,j;var i=e.eq(g+1),f=e.eq(g-1);if(k){j=parseInt(this.value);if(i.length&&!i.attr("readOnly")){i.val(j+1);a=true;i.trigger("change",[j+1])}}else{j=parseInt(this.value);if(f.length&&!f.attr("readOnly")){f.val(j-1);a=true;f.trigger("change",[j-1])}}});e.first().attr("readonly",true);e.last().attr("readonly",true);return c}};visualHUD.Libs.formBuilderMixin={getByType:function(a){return this[a]},getByName:function(a){return this[a]},base:{getSelectBasic:function(a){return _.extend({type:"select",name:"select",label:"Select",width:"120px",value:null,options:[]},a||{})},getRangeInputBasic:function(a){return _.extend({type:"rangeInput",name:"input",label:"Range Input",min:0,max:100,value:null},a||{})},getColorInputBasic:function(a){return _.extend({type:"colorPicker",name:"input",label:"Color",value:null},a||{})},getIconStyleSelectOptions:function(){var a=this.getCollection("HUDItemIconEnums").get(this.model.get("name"));var b=a.get("options");var c={};_.each(b,function(e,d){c[String(d)]=e.name});return c},getIconPositionOptions:function(){return{left:"Left",top:"Top",right:"Right",bottom:"Bottom"}},getTextStyleOptions:function(){return{"0":"Normal","3":"Drop shadow"}},getBorderRadiusOptions:function(){return{"0":"None","3":"3px","5":"5px","8":"8px"}},getOwnerDrawOptions:function(){return{"0":"Any Game Type",CG_SHOW_ANYNONTEAMGAME:"Any Non Team Game",CG_SHOW_ANYTEAMGAME:"Any Team Game",CG_SHOW_CLAN_ARENA:"Clan Arena Only",CG_SHOW_TOURNAMENT:"Duel Only",CG_SHOW_IF_WARMUP:"Warm-up Only",CG_SHOW_IF_NOT_WARMUP:"Game Only (Not Warm-up)",CG_SHOW_CTF:"CTF Only"}},getGradientOptions:function(){return{"0":"Solid",Gradient:{"1":"Top to bottom","2":"Bottom to top","3":"Left to right","4":"Right to left"}}},getTextColorInput:function(){return this.getColorInputBasic({name:"textColor",label:"Color",value:this.model.get("textColor")})},getIconStyleSelect:function(){return this.getSelectBasic({name:"iconStyle",label:"Icon",value:this.model.get("iconStyle"),options:this.getIconStyleSelectOptions()})},getIconPositionSelect:function(){return this.getSelectBasic({name:"iconPosition",label:"Position",value:this.model.get("iconPosition"),options:this.getIconPositionOptions()})},getIconSpacingInput:function(){return this.getRangeInputBasic({name:"iconSpacing",label:"Margin",max:32,value:this.model.get("iconSpacing")})},getIconSizeInput:function(){return this.getRangeInputBasic({name:"iconSize",label:"Size",max:32,value:this.model.get("iconSize")})},getIconOpacityInput:function(){return this.getRangeInputBasic({name:"iconOpacity",label:"Opacity",value:this.model.get("iconOpacity")})},getTextStyleSelect:function(){return this.getSelectBasic({name:"textStyle",label:"Style",value:this.model.get("textStyle"),options:this.getTextStyleOptions()})},getTextSizeInput:function(){return this.getRangeInputBasic({name:"textSize",label:"Size",value:this.model.get("textSize")})},getTextOpacityInput:function(){return this.getRangeInputBasic({name:"textOpacity",label:"Opacity",value:this.model.get("textOpacity")})},getWidthInput:function(){return this.getRangeInputBasic({name:"width",label:"Width",min:this.model.get("minWidth"),max:this.model.get("maxWidth"),value:this.model.get("width")})},getHeightInput:function(){return this.getRangeInputBasic({name:"height",label:"Height",min:this.model.get("minHeight"),max:this.model.get("maxHeight"),value:this.model.get("height")})},getPaddingInput:function(){return this.getRangeInputBasic({name:"padding",label:"Padding",min:0,max:10,value:this.model.get("padding")})},getOpacityInput:function(){return this.getRangeInputBasic({name:"opacity",label:"Opacity",min:0,max:100,value:this.model.get("opacity")})},getPowerupLayoutOptions:function(){return{left:"Left to right",right:"Right to left",top:"Top to bottom",bottom:"Bottom to top"}},getBarDirectionOptions:function(){return{"0":"Left to right","1":"Right to left"}},getAvailabilityControls:function(){return{type:"fieldset",label:"Availability",items:[this.getSelectBasic({label:"During",name:"ownerDrawFlag",value:this.model.get("ownerDrawFlag"),options:this.getOwnerDrawOptions()})]}}},general:{createControls:function(c){var a=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconStyleSelect(),this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput(),{type:"checkbox",name:"teamColors",boxLabel:"Use team colors",checked:this.model.get("teamColors")}]},{type:"fieldset",label:"Text Properties",items:[this.getTextStyleSelect(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Color Range",items:[{type:"colorRange",name:"colorRanges",ranges:this.model.get("colorRanges")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Align"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},ammoIndicator:{createControls:function(c){var a=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput()]},{type:"fieldset",label:"Text Properties",items:[this.getTextStyleSelect(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Color Range",items:[{type:"colorRange",name:"colorRanges",ranges:this.model.get("colorRanges")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Align"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},timer:{createControls:function(c){var a=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput()]},{type:"fieldset",label:"Text Properties",items:[{type:"textbox",name:"text",label:"Time",size:10,maxlength:5,value:this.model.get("text")},this.getTextStyleSelect(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},powerupIndicator:{createControls:function(c){var a=[{type:"fieldset",label:"Icon Properties",items:[this.getSelectBasic({name:"iconPosition",label:"Stack",value:this.model.get("iconPosition"),options:this.getPowerupLayoutOptions()}),this.getIconSpacingInput(),this.getIconSizeInput(),{type:"checkbox",name:"singlePowerup",boxLabel:"Show single icon",checked:this.model.get("singlePowerup")}]},{type:"fieldset",label:"Text Properties",items:[this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},accuracyIndicator:{createControls:function(c){var a=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconStyleSelect(),this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput()]},{type:"fieldset",label:"Text Properties",items:[this.getTextStyleSelect(),this.getTextColorInput(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},skillIndicator:{createControls:function(c){var a=[this.getAvailabilityControls(),{type:"fieldset",label:"Text Properties",items:[this.getTextColorInput(),{type:"textbox",name:"template",label:"Tpl",size:32,maxlength:"64",value:this.model.get("template")}]},{type:"fieldset",label:"Text Style",items:[this.getTextStyleSelect(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Color Range",items:[{type:"colorRange",name:"colorRanges",ranges:this.model.get("colorRanges")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},iconItem:{getIconSizeInput:function(){return this.getRangeInputBasic({name:"iconSize",label:"Size",min:8,max:48,value:this.model.get("iconSize")})},createControls:function(c){var a=[{type:"fieldset",label:"Icon Properties",items:[this.getIconSizeInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},flagIndicator:{createControls:function(c){var a=[{type:"fieldset",label:"Icon Properties",items:[this.getIconStyleSelect(),this.getIconSizeInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},obits:{createControls:function(c){var a=[{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},scoreBox:{getIconSpacingInput:function(){return this.getRangeInputBasic({name:"iconSpacing",label:"Spacing",max:8,value:this.model.get("iconSpacing")})},getLayoutOptions:function(){return{vertical:"Vertical",horizontal:"Horizontal"}},getModeOptions:function(){return{ffa:"FFA / Duel",tdm:"Teamplay"}},createControls:function(c){var a=[{type:"fieldset",label:"Scorebox Properties",items:[this.getIconStyleSelect(),this.getSelectBasic({name:"scoreboxLayout",label:"Layout",value:this.model.get("scoreboxLayout"),options:this.getLayoutOptions()}),this.getIconSpacingInput(),this.getSelectBasic({name:"scoreboxMode",label:"Mode",value:this.model.get("scoreboxMode"),options:this.getModeOptions()})]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},bar:{createControls:function(c){var a=[this.getAvailabilityControls(),{type:"fieldset",label:this.model.get("label")+" Properties",items:[this.getSelectBasic({name:"barDirection",label:"Direction",value:this.model.get("barDirection"),options:this.getBarDirectionOptions()}),this.getWidthInput(),this.getHeightInput(),this.getPaddingInput(),{type:"colorPicker",name:"color",label:"Color",value:this.model.get("color")},this.getOpacityInput()]},{type:"fieldset",label:"Color Range",items:[{type:"colorRange",name:"colorRanges",ranges:this.model.get("colorRanges")},this.getRangeInputBasic({name:"barsOpacity",label:"Opacity",min:0,max:100,value:this.model.get("barsOpacity")})]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},rect:{createControls:function(c){var a=[this.getAvailabilityControls(),{type:"fieldset",label:this.model.get("label")+" Properties",items:[this.getWidthInput(),this.getHeightInput(),this.getSelectBasic({name:"borderRadius",label:"Rounded",value:this.model.get("borderRadius"),options:this.getBorderRadiusOptions()}),this.getSelectBasic({name:"boxStyle",label:"Style",width:"182px",value:this.model.get("boxStyle"),options:this.getGradientOptions()}),{type:"colorPicker",name:"color",label:"Color",value:this.model.get("color")},this.getOpacityInput(),{type:"checkbox",name:"teamColors",boxLabel:"Use team colors",checked:this.model.get("teamColors")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},chatArea:{createControls:function(c){var a=[{type:"fieldset",label:this.model.get("label")+" Properties",items:[this.getWidthInput(),this.getHeightInput(),this.getPaddingInput(),this.getSelectBasic({name:"borderRadius",label:"Rounded",value:this.model.get("borderRadius"),options:this.getBorderRadiusOptions()}),this.getSelectBasic({name:"boxStyle",label:"Style",width:"182px",value:this.model.get("boxStyle"),options:this.getGradientOptions()}),{type:"colorPicker",name:"color",label:"Color",value:this.model.get("color")},this.getOpacityInput(),{type:"checkbox",name:"showChat",boxLabel:"Show chat",checked:this.model.get("showChat")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}},medal:{createControls:function(c){var a=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconStyleSelect(),this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput()]},{type:"fieldset",label:"Text Properties",items:[{type:"textbox",label:"Text",name:"text",size:16,maxlength:4,value:this.model.get("text")},this.getTextColorInput(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Align"}]}];var b=this.buildForm(a);c.get(0).appendChild(b)}}};(function(d){d.event.props.push("dataTransfer");d.fn.coordinates=function(h,e){if(!this[0]){return{top:0,left:0,right:0,bottom:0,width:0,height:0}}var g=h?"position":"offset";var f=this[g]();g=e?"outerWidth":"width";f.width=this[g]();g=e?"outerHeight":"height";f.height=this[g]();f.right=f.left+f.width;f.bottom=f.top+f.height;return f};d.fn.disableSelection=function(){if(window.getSelection){window.getSelection().removeAllRanges()}else{if(document.selection&&document.selection.clear){document.selection.clear()}}return this.each(function(){d(this).attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).each(function(){d(this).bind("selectstart",function(){return false})})})};d.fn.enableSelection=function(){return this.each(function(){d(this).attr("unselectable","").css({"-moz-user-select":"","-o-user-select":"","-khtml-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":""}).each(function(){d(this).unbind("selectstart")})})};var b=/select|textarea/i;var a=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i;d.fn.serializeForm=function(){var e={};this.map(function(){return jQuery.makeArray(d(this).getFormElements())}).filter(function(){return this.name&&!this.disabled&&(this.checked||b.test(this.nodeName)||a.test(this.type))}).map(function(f,g){var h=jQuery(this).val();e[g.name]=h}).get();return e};d.fn.deserialize=function(h,e){var g=h;me=this;if(h===undefined){return me}e=d.extend({isPHPnaming:false,overwrite:true},e);if(h.constructor==Array){g={};for(var f=0;f<h.length;f++){if(typeof g[h[f].name]!="undefined"){if(g[h[f].name].constructor!=Array){g[h[f].name]=[g[h[f].name],h[f].value]}else{g[h[f].name].push(h[f].value)}}else{g[h[f].name]=h[f].value}}}me.find("input,select,textarea").each(function(){var n=this.name;var k=[];if(e.isPHPnaming){n=n.replace(/\[\]$/,"")}if(n&&g[n]!=undefined){k=g[n].constructor==Array?g[n]:[g[n]]}if(e.overwrite===true||g[n]){switch(this.type||this.tagName.toLowerCase()){case"radio":case"checkbox":this.checked=false;for(var m=0;m<k.length;m++){this.checked|=(this.value!=""&&k[m]==this.value)}break;case"select-multiple"||"select":for(m=0;m<this.options.length;m++){this.options[m].selected=false;for(var l=0;l<k.length;l++){this.options[m].selected|=(this.options[m].value!=""&&this.options[m].value==k[l])}}break;case"button":case"submit":this.value=k.length>0?k.join(","):this.value;break;default:this.value=k.join(",")}}});return me};d.fn.getFormElements=function(){var e=d("input,select,textarea",this);return e};var c=function(){d.__overlay.css({height:d(document).height()})};d.showModalOverlay=function(g,e,i){if(typeof g=="function"){i=g;g=null}if(typeof e=="function"){i=e;e=null}if(g<1){var h=e;e=g;g=h}if(e>=1){var h=g;g=e;e=h}g=(g>0)?g:500;e=(e>0)?e:0.5;var f=[{display:"block",height:d(document).height()+"px",left:"0px",opacity:0,position:"absolute",top:"0px",width:"100%"},{display:"block",opacity:0,height:d(document).height()}];if(!this.__overlay){this.__overlay=this("<div></div>").attr({id:"dimScreen"}).css(f[0]).appendTo(document.body);d.data(d.__overlay[0],"options",{fade_opacity:e,speed:g})}else{this.__overlay.css(f[1]);if(this.__overlayFix){this.__overlayFix.css(f[1])}}d(window).bind("resize",c);this.__overlay.stop().fadeTo(g,e,i);this.__overlay.visible=true;return this.__overlay};d.hideModalOverlay=function(i){var e=this.__overlay;var g=d.data(d.__overlay[0],"options");var f=g.fade_opacity;var h=window.ie6?0:g.speed;e.fadeOut(h,function(){if(d.__overlayFix){d.__overlayFix.css({display:"none"})}if(typeof i=="function"){i()}});d(window).unbind("resize",c);this.__overlay.visible=false}})(jQuery);visualHUD.Libs.colorHelper=(function(){var e=false;var h;var g;var a;var c;var d;var b=null;var f=["FFFFFF","FF8AD8","FF928A","FFBA8A","fccc30","FDFF8A","DAFF58","a1fb6e","7ff7e0","54cdf5","5ba8f5","5537ff","a053ed","CCCCCC","FF00BA","FF0000","F06300","FFA000","ECF000","BBF000","56F000","00F0C1","00B4F0","0077F0","2e15f1","732fbe","999999","CC0087","CC0E00","CC5400","CC7F00","C9CC00","9FCC00","4ACC00","00CCA4","0099CC","0065CC","1a05c4","501a8c","666666","990066","990A00","993F00","996000","979900","789900","389900","00997B","007399","004C99","1100a0","391166","333333","660043","660700","662A00","664000","646600","506600","256600","006652","004C66","003266","0c0073","250b41","000000","330021","330400","331500","332000","323300","273300","123300","003329","002633","001933","060033","190033"];return{setupColorPicker:function(j){if(b==null){var k=$(document.body);var l=(["<% _.each(colors, function(color) { %>",'<div class="color-cell" style="background-color:#<%= color %>"><input type="hidden" value="<%= color %>" name="color"/></div>',"<% }); %>"]).join("");var i=this.menuEventsHandler;$(j).on("click","div.color-picker-box",visualHUD.Function.bind(this.showColorPicker,this));$(j).on("click","input.color-input",visualHUD.Function.bind(this.showColorPicker,this));$(j).on("change","input.color-input",visualHUD.Function.bind(this.updateColor,this));b=new visualHUD.Widgets.PopOver({scope:this,position:"left-center",html:_.template(l,{colors:f}),render:function(m){c=m.$content.find("div.color-cell");m.$el.addClass("color-picker-popover");m.$content.on("mouseover mouseout click","div.color-cell",visualHUD.Function.bind(i,this));m.$title.hide()},hide:function(){h&&h.removeClass("active-color")}})}},menuEventsHandler:function(k){if(d){var j=$(k.currentTarget);var i=j.find("input[name=color]").val().toUpperCase();var l=k.type=="mouseout"||k.type=="click"?"removeClass":"addClass";if(k.type=="mouseover"&&b.visible==true){b.setTitle("#"+i);g.val(i);d.css("backgroundColor","#"+i)}if(k.type=="mouseout"&&b.visible==true){b.setTitle("#"+a);g.val(a);d.css("backgroundColor","#"+a)}j[l]("color-cell-hover");if(k.type=="click"){b.hide();e=true;g.trigger("change");return false}e=false}},showColorPicker:function(i){c.filter(".active-color").removeClass("active-color");if(b.visible==true&&d&&d.get(0)==i.currentTarget){b.hide()}else{d=$(i.currentTarget);if(d.is("input.color-input")){g=d;d=d.next("div.color-picker-box")}else{g=d.prev("input.color-input")}a=g.val();c.each(function(){var k=$(this);var j=String(k.data("color"));if(j.toUpperCase()==a.toUpperCase()){k.addClass("active-color");h=k;return false}});b.setTitle("#"+a);b.show(g,i)}},updateColor:function(k){var j=$(k.currentTarget);var i="";try{i=$.color("#"+j.val());b.hide();d.css("backgroundColor",i.hex)}catch(l){}}}})();visualHUD.Libs.importHelper={checkImageSize:function(a){if(a.size>=visualHUD.MAX_BACKGROUND_SIZE){visualHUD.growl.alert({status:"warning",title:"Maximum file size exceeded",message:_.template(visualHUD.messages.LARGE_IMAGE_WARNING,{imageSize:Math.floor(a.size/1024)+"kb",maxSize:Math.floor(visualHUD.MAX_BACKGROUND_SIZE/1024)+"kb"})});return false}return true},checkImageType:function(a){if(!a.type.match("image.*")){visualHUD.growl.alert({status:"warning",title:"Unsupported file detected",message:_.template(visualHUD.messages.UNSUPPORTED_IMAGE_FORMAT,{imageType:a.type||"unknown"})});return false}return true},checkTextType:function(a){},batchImport:function(a,g){var d=[],e=new FileReader(),h=false,g=_.extend({scope:this,image:false,files:false},g||{}),i=g.scope;var f=function(j){var l=j.type.match("image.*")&&this.checkImageSize(j)==true&&h==false;var k=!!(j.type.match("text.*")||j.name.match("vhud$"));switch(true){case l:e.onload=visualHUD.Function.bind(c,this,[j],true);e.readAsDataURL(j);break;case k:e.onload=visualHUD.Function.bind(b,this,[j],true);e.readAsText(j);break;default:visualHUD.growl.alert({status:"warning",title:"Could not process "+j.name,message:_.template(visualHUD.messages.UNSUPPORTED_FILE_FORMAT,{count:a.length})});break}};var c=function(j){h=true;g.image&&g.image.call(i,j.target.result)};var b=function(k,j){var l=j.name.split(".");l.pop();d.push({name:l.join("."),json:k.target.result});if(a.length>0){f.call(this,a.shift())}else{g.files&&g.files.call(i,d)}};if(a.length){f.call(this,a.shift())}}};visualHUD.Utils.DragZoneBase=function(a){a=_.extend({},this.defaults,a||{});this.setOptions(a);this.initialize.apply(this,arguments)};_.extend(visualHUD.Utils.DragZoneBase.prototype,{currentElement:null,handler:null,defaults:{ticks:2,tolerance:3,ghost:0,opacity:0.5,bodyDragClass:"drag",position:"position"},initialize:function(a){var b=this;this.scope=a.scope||this;this.dropPanel=this.options.dropPanelID?$$(this.options.dropPanelID):$(document);this.bound={dragover:$.proxy(this.options.ondragover,this.dropPanel),dragout:$.proxy(this.options.ondragout,this.dropPanel),start:$.proxy(this.start,this),check:$.proxy(this.check,this),drag:$.proxy(this.drag,this),end:$.proxy(this.end,this)};this.ghost=$('<div class="drag-helper"></div>').css({display:"none",position:"absolute",top:0,left:0}).appendTo(document.body);if(this.options.ondragover){this.dropPanel.bind("mouseover",function(c){b.options.ondragover.apply(b.dropPanel,[c])})}if(this.options.ondragout){this.dropPanel.bind("mouseout",function(c){b.options.ondragout.apply(b.dropPanel,[c])})}if(this.options.init){this.options.init.apply(this.scope,[this])}return this},start:function(d,b){this.currentElement=b;this.handler=$(d.target);this.ticker=this.options.ticks;this.mouse=this.getMouse(d);this.moveOffset={x:0,y:0};if(b){var a=this.options.position;var c=this.currentElement[a]()||{left:this.mouse.x,top:this.mouse.y};this.moveOffset={x:c.left-this.mouse.x,y:c.top-this.mouse.y}}$(document).bind("mousemove",this.bound.check);$(document).bind("mouseup",this.bound.end);$(document.body).disableSelection();if(this.options.onbeforestart){this.options.onbeforestart.apply(this.scope,[this,d,this.mouse])}},check:function(a){var b=this.getMouse(a);if(Math.abs(b.x-this.mouse.x)>this.options.tolerance||Math.abs(b.y-this.mouse.y)>this.options.tolerance){$(document).unbind("mousemove",this.bound.check);$(document).bind("mousemove",this.bound.drag);$(document.body).addClass(this.options.bodyDragClass);if(this.options.onstart){this.options.onstart.apply(this.scope,[this,a,b])}}if(a.stopPropagation){a.stopPropagation()}if(a.preventDefault){a.preventDefault()}return false},drag:function(a){if(this.ticker==this.options.ticks){var b=this.getMouse(a);var c={left:b.x+this.moveOffset.x,top:b.y+this.moveOffset.y};if(this.options.grid){c.left-=c.left%this.options.grid;c.top-=c.top%this.options.grid}if(this.options.ondrag){this.options.ondrag.apply(this.scope,[this,a,c,b])}this.ticker=0}else{this.ticker++}if(a.stopPropagation){a.stopPropagation()}if(a.preventDefault){a.preventDefault()}return false},end:function(b){$(document).unbind("mousemove",this.bound.check);$(document).unbind("mousemove",this.bound.drag);$(document).unbind("mouseup",this.bound.end);this.ghost.empty().css({display:"none"});$(document.body).removeClass(this.options.bodyDragClass).css("cursor","");$(document.body).enableSelection();var a=$(b.target);if(this.options.ondrop){this.options.ondrop.apply(this.scope,[this,b,a])}if(b.stopPropagation){b.stopPropagation()}if(b.preventDefault){b.preventDefault()}return false},setOptions:function(a){this.options=this.options||{};_.extend(this.options,a||{});if(a.dropables){this.options.dropables=$(a.dropables)}},getMouse:function(a){return{x:a.pageX,y:a.pageY}}});visualHUD.Models.ClientSettings=Backbone.Model.extend({defaults:{HUDName:null,scaleFactor:2,fullScreenView:false,pinSidebar:true,lagometr:false,speedometr:false,pickup:false,snapGrid:"0",drawGrid:"0",drawGun:"1",drawWeaponbar:"1",drawTeamoverlay:"0",canvasShot:"1",statusSkill:"90",statusAccuracy:"47",statusHealth:"200",statusArmor:"100",statusAmmo:"25",customBackground:null},initialize:function(){var a=window.localStorage.getItem("vhudClient");if(a!==null){a=JSON.parse(a);this.set(a)}this.on("change",this.save,this)},save:function(){var b=this.toJSON();var a={fullScreenView:false};_.extend(b,a);window.localStorage.setItem("vhudClient",JSON.stringify(b))},reset:function(){this.set(this.defaults);this.save()},getStatusByName:function(a){switch(a){case"armorIndicator":case"armorbar":return this.get("statusArmor");break;case"ammoIndicator":return this.get("statusAmmo");break;case"healthIndicator":case"healthBar":return this.get("statusHealth");break;case"accuracyIndicator":return this.get("statusAccuracy");break;case"skillIndicator":return this.get("statusSkill");break}return null}});visualHUD.Models.HUDItem=Backbone.Model.extend({defaults:{index:0,itemType:null,iconPosition:null,iconSpacing:null,iconOpacity:null,iconSize:null,iconStyle:null,textSize:null,textOpacity:null,textStyle:null,textColor:"FFFFFF",teamColors:null,colorRanges:null,coordinates:{top:0,left:0,width:null,height:null},iconCoordinates:{},textCoordinates:{},cssClass:null,label:null,name:null,text:null,borderRadius:0,boxStyle:0,template:null,singlePowerup:true,padding:null,toggleChat:null,scoreboxLayout:null,scoreboxMode:null,barDirection:null,resizable:false,group:null,ownerDrawFlag:"0"},defaultsByName:{chatArea:{coordinates:{top:245,left:0,width:640,height:160},showChat:false,color:"000000",opacity:75,padding:3,width:640,height:160,minWidth:1,minHeight:1,maxWidth:640,maxHeight:480,boxStyle:2,borderRadius:0},timer:{colorRanges:[],text:"2:47"},ammoIndicator:{colorRanges:[{name:"Low",color:"FF0000",range:[-999,5]},{name:"Normal",color:"FFFFFF",range:[6,100]},{name:"Hight",color:"FFFFFF",range:[101,999]}]},skillIndicator:{colorRanges:[{name:"Low",color:"56F000",range:[0,33]},{name:"Normal",color:"ECF000",range:[34,66]},{name:"Hight",color:"CC0E00",range:[67,999]}],template:"Skill rating",textSize:20,textStyle:0,textColor:"FFFFFF",text:100,ownerDraw:"0",textOpacity:100},medal:{text:"27",colorRanges:[],ownerDrawFlag:0,textStyle:0,textSize:50},powerupIndicator:{colorRanges:[],layout:"vertical",iconStyle:null,iconSize:24,textSize:55,iconSpacing:4,text:"32"},scoreBox:{scoreboxLayout:"vertical",iconSpacing:2,iconStyle:0,scoreboxMode:"ffa"}},defaultsByType:{general:{colorRanges:[{name:"Low",color:"FF0000",range:[-999,25]},{name:"Normal",color:"FCCC30",range:[26,100]},{name:"Hight",color:"FFFFFF",range:[101,999]}],iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:32,iconStyle:0,textSize:100,textOpacity:100,textStyle:"3",teamColors:true},iconItem:{iconStyle:0,iconSize:24,iconOpacity:100},scoreBox:{mode:"ffa",spacing:1,iconSpacing:10},flagIndicator:{iconStyle:0,iconSize:32,iconOpacity:100},obits:{iconStyle:0,iconSize:null,text:["Klesk","Xaero"]},rect:{color:"FFFFFF",opacity:100,width:100,height:100,minWidth:1,minHeight:1,maxWidth:640,maxHeight:480,teamColors:false,boxStyle:0,hairLine:0,borderRadius:0,coordinates:{width:100,height:100},resizable:true},bar:{colorRanges:[{name:"Low",color:"FF0000",range:[-999,25]},{name:"Normal",color:"FFFFFF",range:[26,100]},{name:"Hight",color:"FFA000",range:[101,999]}],color:"000000",opacity:30,width:100,height:24,minWidth:1,minHeight:1,maxWidth:640,maxHeight:100,padding:0,barsOpacity:70,text:125,barDirection:0,coordinates:{width:100,height:24},resizable:true}},initialize:function(a){this.legacyCleanUp()},setDefaultValues:function(c){var b=this.getDefaultsByType(c.itemType)||{},a=this.getDefaultsByName(c.name)||{};_.extend(this.attributes,c,b,a);return this},getDefaultsByType:function(a){return this.defaultsByType[a]||null},getDefaultsByName:function(a){return this.defaultsByName[a]||null},legacyCleanUp:function(){var a=this.attributes;if(a.itemType=="obits"){this.set(this.getDefaultsByType(a.itemType),{silent:true})}if(a.name=="scoreBox"){if("scoreboxStyle" in a){this.set({iconStyle:a.scoreboxStyle},{silent:true});delete datascoreboxStyle}if("spacing" in a){this.set({iconSpacing:a.spacing},{silent:true});delete a.spacing}if("layout" in a){this.set({scoreboxLayout:a.layout},{silent:true});delete a.layout}if("mode" in a){this.set({scoreboxMode:a.mode},{silent:true});delete a.mode}}if(a.name=="accuracyIndicator"){this.set({itemType:"general",iconStyle:0,name:"medal"},{silent:true})}if(a.name=="powerupIndicator"&&a.iconStyle!=null){this.set({iconStyle:null},{silent:true})}if(this.get("ownerDraw")==""){this.set({ownerDraw:"0"},{silent:true})}if(a.name=="skillIndicator"&&"opacity" in a){this.set({textOpacity:a.opacity},{silent:true});delete a.opacity}if("rbox" in a){delete a.rbox}if("iconCoordinates" in a){delete a.iconCoordinates}if("textCoordinates" in a){delete a.textCoordinates}}});visualHUD.Collections.DictionaryAbstract=Backbone.Collection.extend({autoLoad:true,getData:function(){return[]},load:function(){this.reset(this.getData(),{silent:true});return this}});visualHUD.Collections.HUDItemIconEnums=visualHUD.Collections.DictionaryAbstract.extend({getData:function(){return[{id:"armorIndicator",options:[{name:"QL Armor",url:"resources/images/icons/armor.png"},{name:"Q3A Armor",url:"resources/images/icons/iconr_red.png"}]},{id:"healthIndicator",options:[{name:"QL Health",url:"resources/images/icons/health.png"},{name:"Head icon",url:"resources/images/icons/icon_head.png"}]},{id:"ammoIndicator",options:[{name:"Rocketlauncher",url:"resources/images/icons/iconw_rocket.png"}]},{id:"powerupIndicator",options:[{name:"Quad",url:"resources/images/icons/quad.png"},{name:"Regeneration",url:"resources/images/icons/regen.png"}]},{id:"accuracyIndicator",options:[{name:"Accuracy medal",url:"resources/images/icons/medal_accuracy.png"}]},{id:"CTFPowerupIndicator",options:[{name:"Scout",url:"resources/images/icons/scout.png"}]},{id:"scoreBox",options:[{name:"Classic Full",url:null},{name:"Classic Small",url:null},{name:"Compact",url:null}]},{id:"timer",options:[{name:"Clock",url:"resources/images/icons/icon_time.png"}]},{id:"playerItem",options:[{name:"Medkit",url:"resources/images/icons/medkit.png"}]},{id:"obits",options:[{name:"Rocketlauncher",url:"resources/images/icons/iconw_rocket.png"}]},{id:"flagIndicator",options:[{name:"Flag 1",url:"resources/images/icons/flag.png"},{name:"Flag 2",url:"resources/images/icons/iconf_blu1.png"},{name:"Flag 3",url:"resources/images/icons/flag_3_1.png"},{name:"Flag 4",url:"resources/images/icons/flag_3_2.png"}]},{id:"skillIndicator",options:[]},{id:"medal",options:[{name:"Accuracy medal",url:"resources/images/icons/medal_accuracy.png"},{name:"Gauntlet medal",url:"resources/images/icons/medal_gauntlet.png"},{name:"Excellent medal",url:"resources/images/icons/medal_excellent.png"},{name:"Impressive medal",url:"resources/images/icons/medal_impressive.png"},{name:"Captures medal",url:"resources/images/icons/medal_capture.png"},{name:"Assist medal",url:"resources/images/icons/medal_assist.png"},{name:"Defend medal",url:"resources/images/icons/medal_defend.png"}]}]}});visualHUD.Collections.HUDItems=Backbone.Collection.extend({name:"HUDItems",LOCAL_STORAGE_KEY:"HUDItems",model:visualHUD.Models.HUDItem,initialize:function(){this.on("add",this.setIndex,this);this.on("load",this.updateIndexes,this);this.on("change:ownerDrawFlag",function(a,b){this.filter&&this.filterItemsByOwnerDraw(this.filter)},this);$(window).unload(visualHUD.Function.bind(this.save,this,[]))},save:function(){var a=this.toJSON();window.localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(a))},load:function(a){var a=a||window.localStorage.getItem(this.LOCAL_STORAGE_KEY),c=false;if(_.isString(a)){try{a=JSON.parse(a)}catch(b){console.warn("Invalid HUD JSON data")}}if(a&&a.length){try{this.reset(a,{silent:true});this.cleanDefaultChat();c=true}catch(b){console.warn("Invalid HUD data")}}this.trigger("load",c)},setIndex:function(a){a.set("index",this.length,{silent:true})},updateIndexes:function(){this.each(function(a,b){a.set("index",b,{silent:true})})},comparator:function(a){return a.get("index")},cleanDefaultChat:function(){var a=this.where({name:"chatArea",isDefaultChat:true});if(a.length){this.remove(a,{silent:true})}},serialize:function(){this.sort();var a=[],b=new this.model();b.setDefaultValues({isDefaultChat:true,itemType:"chatArea",name:"chatArea"});this.each(function(c){var f=c._HUDItem,g=c.toJSON(),e=f.getDOMRefs();if(g.itemType=="general"){g.iconCoordinates={top:e.iconBlock[0].offsetTop/visualHUD.scaleFactor,left:e.iconBlock[0].offsetLeft/visualHUD.scaleFactor,width:e.iconBlock.eq(0).width()/visualHUD.scaleFactor,height:e.iconBlock.eq(0).height()/visualHUD.scaleFactor};g.textCoordinates={top:e.textBlock[0].offsetTop/visualHUD.scaleFactor,left:e.textBlock[0].offsetLeft/visualHUD.scaleFactor,width:e.textBlock.eq(0).width()/visualHUD.scaleFactor,height:e.textBlock.eq(0).height()/visualHUD.scaleFactor}}if(g.itemType=="textItem"){g.textCoordinates={top:e.templateText[0].offsetTop/visualHUD.scaleFactor,left:e.templateText[0].offsetLeft/visualHUD.scaleFactor,width:e.templateText.eq(0).width()/visualHUD.scaleFactor,height:e.templateText.eq(0).height()/visualHUD.scaleFactor};g.counterCoordinates={top:e.counter[0].offsetTop/visualHUD.scaleFactor,left:e.counter[0].offsetLeft/visualHUD.scaleFactor,width:e.counter.eq(0).width()/visualHUD.scaleFactor,height:e.counter.eq(0).height()/visualHUD.scaleFactor}}if(g.itemType=="rect"){var d=parseInt(g.borderRadius,10);if(d>0){g.boxStyle=0;g.rbox=visualHUD.Libs.utility.getRCornersMarkup(g)}}if(g.name=="chatArea"){b=null}a.push(g)});b&&a.push(b.toJSON());b=null;return a},filterItemsByOwnerDraw:function(a){this.each(function(b){var d=b._HUDItem,e=b.get("ownerDrawFlag"),c=d.getDOMRefs();if(a=="0"||e==a||e=="0"){d.show()}else{d.hide()}});this.filter=a}});visualHUD.Collections.HUDItemTemplates=visualHUD.Collections.DictionaryAbstract.extend({getData:function(){var b=function(){return['<div class="item-icon"><img src="<%= icon.url %>"/></div>','<div class="item-counter"><span class="counter"><%= text %></span></div>']};var c=function(){return['<div class="item-icon"><img src="<%= icon.url %>"/></div>']};var a=function(){return['<div class="hud-item-box">','<div class="h-bar h100"><div class="h-bar h200"></div></div>',"</div>"]};return[{id:"healthIndicator",itemType:"general",cssClass:"",template:b()},{id:"healthBar",itemType:"bar",cssClass:"health-bar",template:a()},{id:"armorIndicator",itemType:"general",cssClass:"",template:b()},{id:"armorBar",itemType:"bar",cssClass:"armor-bar",template:a()},{id:"ammoIndicator",itemType:"general",cssClass:"",template:b()},{id:"timer",itemType:"general",cssClass:"",template:b()},{id:"powerupIndicator",itemType:"general",cssClass:"",template:['<div class="powerups-wrapper">','<div class="powerup-item">','<div class="item-icon"><img src="<%= icon[0].url %>"/></div> ','<div class="item-counter"><span class="counter"><%= text %></a></span></div>',"</div>",'<div class="powerup-item">','<div class="item-icon"><img src="<%= icon[1].url %>"/></div> ','<div class="item-counter"><span class="counter"><%= text %></a></span></div>',"</div>","</div>"]},{id:"scoreBox",itemType:"scoreBox",cssClass:"scorebox-item",template:['<div class="item-icon team-red"></div><div class="item-icon team-blue"></div>']},{id:"playerItem",itemType:"iconItem",cssClass:"icon-item ",template:c()},{id:"CTFPowerupIndicator",itemType:"iconItem",cssClass:"icon-item ",template:c()},{id:"obits",itemType:"obits",cssClass:"obit-item",template:['<div class="item-counter"><span class="counter"><%= text[0] %></span></div>','<div class="item-icon"><img src="<%= icon.url %>"/></div>','<div class="item-counter"><span class="counter"><%= text[1] %></span></div>']},{id:"flagIndicator",itemType:"iconItem",cssClass:"icon-item ",template:c()},{id:"rectangleBox",itemType:"rect",template:['<div class="hud-item-box"></div>']},{id:"medal",itemType:"general",cssClass:"accuracy",template:b()},{id:"skillIndicator",itemType:"textItem",cssClass:"skill-item",template:['<div class="item-counter">','<span class="text"><%= template %></a></span>','<span class="counter"><%= text %></a></span>',"</div>"]},{id:"chatArea",itemType:"chatArea",cssClass:"chat-area",template:['<div class="hud-item-box">','<ul class="chat-messages">','<li class="message-0">','<span class="name"><span style="color: Red" class="mr-5">bwt</span><span style="color: white">namad</span>:</span><span class="message">quad in 30 seconds, team</span>',"</li>",'<li class="message-1">','<span class="name"><span style="color: Red" class="mr-5">bwt</span><span style="color: #3266fe">kN</span><span style="color: Red">a</span><span style="color: #3a63e9">kHstR</span>:</span><span class="message">WTF???</span>',"</li>",'<li class="message-2">','&lt;QUAKE LIVE&gt; <span style="color: Cyan">Ancest0R</span> has gone offline</li>','<li class="message-4">','fatal<span style="color: Red">1</span>ty connected</li>','<li class="message-5">','fatal<span style="color: Red">1</span>ty entered the game</li>','<li class="message-3">','<span class="name">fatal<span style="color: Red">1</span>ty:</span><span class="message">ready to get pwned? ;)</span></li>','<li class="message-6">','<span class="name"><span style="color: Red" class="mr-5">bwt</span><span style="color: white">namad</span>:</span><span class="message">byte my shiny metal ass!</span>',"</li>","</ul>","</div>"]}]}});visualHUD.Collections.StageControlsDictionary=visualHUD.Collections.DictionaryAbstract.extend({getData:function(){return[{id:"healthIndicator",itemType:"general",cssClass:"lib-element-health",label:"Health indicator"},{id:"healthBar",name:"healthBar",itemType:"bar",label:"Health bar",cssClass:"lib-element-hbar"},{id:"armorIndicator",itemType:"general",cssClass:"lib-element-armor",label:"Armor indicator"},{id:"armorBar",name:"armorBar",itemType:"bar",label:"Armor bar",cssClass:"lib-element-abar"},{id:"ammoIndicator",itemType:"general",cssClass:"lib-element-ammo",label:"Ammo indicator"},{id:"timer",itemType:"general",cssClass:"lib-element-timer",label:"Timer"},{id:"powerupIndicator",itemType:"general",cssClass:"lib-element-powerup",label:"Powerup timer"},{id:"scoreBox",itemType:"scoreBox",cssClass:"lib-element-scorebox",label:"Scorebox"},{id:"playerItem",itemType:"iconItem",cssClass:"lib-element-player-item",label:"Usable item indicator"},{id:"CTFPowerupIndicator",itemType:"iconItem",cssClass:"lib-element-ctf-powerup",label:"CTF powerup indicator"},{id:"obits",itemType:"obits",cssClass:"lib-element-obit",label:"Graphical obits"},{id:"flagIndicator",itemType:"iconItem",cssClass:"lib-element-flag",label:"Flag indicator"},{id:"medal",name:"medal",itemType:"general",label:"Medal",cssClass:"lib-element-medal"},{id:"skillIndicator",name:"skillIndicator",itemType:"textItem",label:"Skill Rating Indicator",cssClass:"lib-element-skill"},{id:"chatArea",name:"chatArea",itemType:"rect",label:"Chat area",isSingle:true,cssClass:"lib-element-chat"},{id:"rectangleBox",name:"rectangleBox",itemType:"rect",label:"Rectangle box",cssClass:"lib-element-rect"},{id:"customDefinition",name:"customDefinition",itemType:"customDefinition",label:"Custom Definition <small>Not implemented yet</small>",cssClass:"lib-element-definition disabled"}]}});visualHUD.Collections.HUDPresets=visualHUD.Collections.DictionaryAbstract.extend({getData:function(){return[{id:"largeHUD",isBuiltIn:true,name:"Large_HUD",items:[{itemType:"general",cssClass:"lib-element-armor",label:"Armor indicator",name:"armorIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,99],color:"fccc30"},{name:"High",range:[100,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"5",iconOpacity:100,iconSize:"18",iconStyle:0,textSize:100,textOpacity:100,textStyle:3,teamColors:true,text:"100",textColor:"FFFFFF",coordinates:{top:435,left:400,width:127,height:35,right:527,bottom:471},iconCoordinates:{top:8.5,left:0,width:18,height:18,right:18,bottom:26.5},textCoordinates:{top:0,left:23,width:104,height:35,right:127,bottom:35}},{itemType:"general",cssClass:"lib-element-ammo",label:"Ammo indicator",name:"ammoIndicator",colorRanges:[{name:"Low",range:[-999,5],color:"FF0000"},{name:"Normal",range:[5,99],color:"FFFFFF"},{name:"High",range:[100,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"0",iconOpacity:100,iconSize:"16",iconStyle:0,textSize:"65",textOpacity:100,textStyle:3,teamColors:true,text:"25",textColor:"FFFFFF",coordinates:{top:442,left:113,width:83,height:22,right:196,bottom:464},iconCoordinates:{top:3,left:0,width:16,height:16,right:16,bottom:19},textCoordinates:{top:0,left:16,width:67,height:22,right:83,bottom:22}},{itemType:"general",cssClass:"lib-element-timer",label:"Timer",name:"timer",iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:"0",iconStyle:0,textSize:"60",textOpacity:100,textStyle:3,teamColors:true,text:"0:00",textColor:"FFFFFF",coordinates:{top:3,left:250,width:72,height:21,right:322,bottom:24},iconCoordinates:{top:0,left:0,width:0,height:0,right:0,bottom:0},textCoordinates:{top:0,left:0,width:72,height:21,right:72,bottom:21}},{itemType:"scoreBox",cssClass:"lib-element-scorebox",label:"Scorebox",name:"scoreBox",scoreboxStyle:2,layout:"vertical",mode:"ffa",spacing:1,iconSpacing:10,coordinates:{top:436,left:585,width:50,height:33,right:635,bottom:469}},{itemType:"general",cssClass:"lib-element-powerup",label:"Powerup timer",name:"powerupIndicator",iconPosition:"top",iconSpacing:4,iconOpacity:100,iconSize:24,iconStyle:0,textSize:55,textOpacity:100,textStyle:3,teamColors:true,text:"32",layout:"vertical",textColor:"FFFFFF",singlePowerup:false,coordinates:{top:240,left:571,width:62,height:28,right:633,bottom:268},iconCoordinates:{top:0,left:0,width:24,height:24,right:24,bottom:24},textCoordinates:{top:5,left:28,width:34,height:19,right:62,bottom:24}},{itemType:"iconItem",cssClass:"lib-element-flag",label:"Flag indicator",name:"flagIndicator",iconStyle:"1",iconSize:"38",iconOpacity:100,coordinates:{top:434,left:51,width:38,height:38,right:89,bottom:472}},{itemType:"general",cssClass:"lib-element-health",label:"Health indicator",name:"healthIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"fccc30"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"5",iconOpacity:100,iconSize:"18",iconStyle:0,textSize:100,textOpacity:100,textStyle:3,teamColors:true,text:"100",textColor:"fccc30",coordinates:{top:435,left:243,width:127,height:35,right:370,bottom:470},iconCoordinates:{top:8.5,left:0,width:18,height:18,right:18,bottom:26.5},textCoordinates:{top:0,left:23,width:104,height:35,right:127,bottom:35}},{itemType:"iconItem",cssClass:"lib-element-ctf-powerup",label:"CTF powerup indicator",name:"CTFPowerupIndicator",iconStyle:0,iconSize:16,iconOpacity:100,coordinates:{top:455,left:5,width:16,height:16,right:21,bottom:471}},{itemType:"iconItem",cssClass:"lib-element-player-item",label:"Usable item indicator",name:"playerItem",iconStyle:0,iconSize:16,iconOpacity:100,coordinates:{top:435,left:5,width:16,height:16,right:21,bottom:451}}]},{id:"smallHUD",isBuiltIn:true,name:"Small_HUD",items:[{itemType:"general",cssClass:"lib-element-health",label:"Health indicator",name:"healthIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:32,iconStyle:0,textSize:100,textOpacity:100,textStyle:3,teamColors:true,text:"200",textColor:"FFFFFF",coordinates:{top:414,left:247,width:146,height:36,right:393,bottom:450},iconCoordinates:{top:2,left:0,width:32,height:32},textCoordinates:{top:0,left:42,width:104,height:36}},{isDefaultChat:true,name:"chatArea",coordinates:{top:301,left:0,width:640,height:120},color:"000000",opacity:75,padding:3,width:640,height:120,minWidth:1,minHeight:1,maxWidth:640,maxHeight:480,boxStyle:2,borderRadius:0}]},{id:"defaultHUD",isBuiltIn:true,name:"Normal_HUD",items:[{itemType:"general",cssClass:"lib-element-health",label:"Health indicator",name:"healthIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:"0",iconStyle:0,textSize:"70",textOpacity:100,textStyle:3,teamColors:true,text:"47",textColor:"FFFFFF",coordinates:{top:447,left:204,width:73,height:25,right:277,bottom:472},iconCoordinates:{top:0,left:0,width:0,height:0},textCoordinates:{top:0,left:0,width:73,height:25}},{itemType:"general",cssClass:"lib-element-armor",label:"Armor indicator",name:"armorIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:"0",iconStyle:0,textSize:"70",textOpacity:100,textStyle:3,teamColors:true,text:"55",textColor:"FFFFFF",coordinates:{top:447,left:365,width:73,height:25,right:438,bottom:472},iconCoordinates:{top:0,left:0,width:0,height:0},textCoordinates:{top:0,left:0,width:73,height:25}},{itemType:"general",cssClass:"lib-element-ammo",label:"Ammo indicator",name:"ammoIndicator",colorRanges:[{name:"Low",range:[-999,5],color:"FF0000"},{name:"Normal",range:[6,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"bottom",iconSpacing:"2",iconOpacity:100,iconSize:"14",iconStyle:0,textSize:"42",textOpacity:"60",textStyle:3,teamColors:true,text:"23",textColor:"FFFFFF",coordinates:{top:433,left:300,width:44,height:31,right:344,bottom:464},iconCoordinates:{top:17,left:15,width:14,height:14},textCoordinates:{top:0,left:0,width:44,height:15}},{itemType:"iconItem",cssClass:"lib-element-flag",label:"Flag indicator",name:"flagIndicator",iconStyle:0,iconSize:"32",iconOpacity:100,coordinates:{top:350,left:304,width:32,height:32,right:336,bottom:382}},{itemType:"general",cssClass:"lib-element-powerup",label:"Powerup timer",name:"powerupIndicator",iconPosition:"top",iconSpacing:4,iconOpacity:100,iconSize:"32",iconStyle:0,textSize:55,textOpacity:100,textStyle:3,teamColors:true,text:"32",layout:"vertical",textColor:"FFFFFF",singlePowerup:false,coordinates:{top:222,left:566,width:70,height:36,right:636,bottom:258},iconCoordinates:{top:0,left:0,width:32,height:32},textCoordinates:{top:12,left:36,width:34,height:20}},{itemType:"iconItem",cssClass:"lib-element-player-item",label:"Usable item indicator",name:"playerItem",iconStyle:0,iconSize:"25",iconOpacity:100,coordinates:{top:452,left:520,width:25,height:25,right:545,bottom:477}},{itemType:"iconItem",cssClass:"lib-element-ctf-powerup",label:"CTF powerup indicator",name:"CTFPowerupIndicator",iconStyle:0,iconSize:"25",iconOpacity:100,coordinates:{top:452,left:610,width:25,height:25,right:635,bottom:477}},{itemType:"scoreBox",cssClass:"lib-element-scorebox",label:"Scorebox",name:"scoreBox",scoreboxStyle:0,layout:"horizontal",mode:"ffa",spacing:1,iconSpacing:10,coordinates:{top:5,left:5,width:180,height:35,right:185,bottom:40}},{itemType:"general",cssClass:"lib-element-timer",label:"Timer",name:"timer",iconPosition:"left",iconSpacing:"3",iconOpacity:100,iconSize:"14",iconStyle:0,textSize:"35",textOpacity:100,textStyle:3,teamColors:true,text:"2:18",textColor:"FFFFFF",coordinates:{top:52,left:5,width:47,height:14,right:52,bottom:66},iconCoordinates:{top:0,left:0,width:14,height:14},textCoordinates:{top:1,left:17,width:30,height:13}}]}]}});visualHUD.Collections.CustomHUDPresets=visualHUD.Collections.DictionaryAbstract.extend({LOCAL_STORAGE_KEY:"CustomHUDPresets",getData:function(){var a=window.localStorage.getItem(this.LOCAL_STORAGE_KEY);a=JSON.parse(a);return a||[]},initialize:function(){this.on("all",this.save,this);this.on("add",this.sort,this)},comparator:function(a){return a.get("name")},save:function(){var a=this.toJSON();try{window.localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(a))}catch(b){throw ("visualHUD was unable to save last preset. window.localStorage space quota exceeded")}}});visualHUD.Views.Viewport=Backbone.View.extend({tagName:"div",className:"vh-viewport",pinned:true,canvasDragMoveAllowed:false,htmlTpl:['<div class="vh-region vh-viewport-topbar"></div>','<div class="vh-region vh-viewport-sidebar">','<div class="vh-region vh-viewport-sidebar-content">','<div class="pin-sidebar-action sidebar-pinned" title="Pin sidebar"><div class="pin-sidebar-icon"></div></div>',"</div>","</div>",'<div class="vh-region vh-viewport-bottombar"></div>','<div class="vh-region vh-viewport-center"></div>'],events:{mousedown:"checkDragDrop","click .pin-sidebar-action":"toggleSidebarPin"},initialize:function(){var a=this;this.bound={trackResize:$.proxy(this,"trackResize"),trackSpaceDown:$.proxy(this,"trackSpaceDown"),trackSpaceUp:$.proxy(this,"trackSpaceUp")};this.$el.append(this.htmlTpl.join(""));this.$el.disableSelection();this.getDOMRefs();this.initializeClientSettings();this.setupCanvasDrag();this.bindDropImport()},render:function(a){this.setNestedViews(a);this.$el.appendTo(document.body);this.trackResize();this.trigger("render",[this])},setNestedViews:function(a){_.each(a,function(b){var c="get"+b.getAlias().split(".").pop()+"View";this[c]=function(){return b}},this)},getDOMRefs:function(){this.$topArea=this.$el.find(".vh-viewport-topbar");this.$sidebarArea=this.$el.find(".vh-viewport-sidebar-content");this.$sidebarWrapper=this.$el.find(".vh-viewport-sidebar");this.$bottomtArea=this.$el.find(".vh-viewport-bottombar");this.$centerArea=this.$el.find(".vh-viewport-center");this.$pinSidebarIcon=this.$el.find(".pin-sidebar-action")},initializeClientSettings:function(){var a=this.options.clientSettingsModel;a.on("change:pinSidebar",this.setSidebarState,this);a.on("change:fullScreenView",this.toggleToolbars,this);this.setSidebarState(a,a.get("pinSidebar"));this.toggleToolbars(a,a.get("fullScreenView"))},trackResize:function(a){this.$el.css({height:$("body").height()+"px"});if(this.pinned==false){this.$centerArea.css({marginLeft:"",left:"",top:""});this.pinned=true}},trackSpaceDown:function(a){if(a.keyCode==32){$(document).unbind("keydown",this.bound.trackSpaceDown);$(document).bind("keyup",this.bound.trackSpaceUp);$(document.body).addClass("drag");this.canvasDragMoveAllowed=true}},trackSpaceUp:function(a){if(a.keyCode==32){$(document).bind("keydown",this.bound.trackSpaceDown);$(document).unbind("keyup",this.bound.trackSpaceUp);$(document.body).removeClass("drag");this.canvasDragMoveAllowed=false}},setupCanvasDrag:function(){var a=this,b;$(window).bind("resize.canvas",this.bound.trackResize);$(document).bind("keydown",this.bound.trackSpaceDown);this.drag=new visualHUD.Utils.DragZoneBase({scope:this,ticks:2,tolerance:2,grid:1,onbeforestart:function(e,f,d){var c=this.$centerArea.position();this.pinned=false;e.moveOffset={x:c.left-d.x,y:c.top-d.y}},ondrag:function(d,e,c){this.$centerArea.css(c)}})},checkDragDrop:function(a){if(this.canvasDragMoveAllowed==true){this.drag.start(a,this.$centerArea)}},hideAllSidebarItems:function(){this.$sidebarArea.children().not(".pin-sidebar-action").hide()},toggleToolbars:function(b,d){var c=this.options.clientSettingsModel,a=c.get("pinSidebar");if(d==false){this.$sidebarWrapper.css("right","");this.bindSidebarSlideEvents(false)}else{if(a==false){this.slideSidebar(false);this.bindSidebarSlideEvents(true)}}this.$el.toggleClass("tools-off",d);this.$el.toggleClass("tools-on",!d);$(window).trigger("resize.form")},slideSidebar:function(c){var a=c==true?0:-1*(this.$sidebarWrapper.width()-30);var b=parseInt(this.$sidebarWrapper.css("right"),10)||0;if(a==b){return}this.$sidebarWrapper.stop().animate({right:a},{duration:200})},toggleSidebarPin:function(){var b=this.options.clientSettingsModel,a=b.get("pinSidebar");b.set("pinSidebar",!a);this.bindSidebarSlideEvents(a)},bindSidebarSlideEvents:function(b){if(b==true){var a=visualHUD.Function.createBuffered(this.slideSidebar,300,this);this.$sidebarArea.bind("mouseenter.slide",function(c){a(true);c.stopPropagation()});this.$sidebarWrapper.bind("mouseleave.slide",function(c){a(false);c.stopPropagation()})}else{this.$sidebarArea.unbind("mouseenter.slide");this.$sidebarWrapper.unbind("mouseleave.slide")}},setSidebarState:function(a,b){this.$pinSidebarIcon.toggleClass("sidebar-pinned",b)},bindDropImport:function(){$(document).on("dragenter dragleave dragover drop",visualHUD.Function.bind(function(b){b.preventDefault();if(b.type=="drop"){var a=Array.prototype.slice.call(b.dataTransfer.files);visualHUD.Libs.importHelper.batchImport(a,{scope:this,files:function(c){this.trigger("load.text",[c])},image:function(c){this.trigger("import.image",[c])}});return false}return false},this))}});visualHUD.Views.viewport.TopBar=Backbone.View.extend({tagName:"div",className:"app-topbar",htmlTpl:['<div class="app-logo popover-action" data-popover="logo"><span>VisualHUD</span></div>','<div class="toolbar-main global-actions">','<button value="downloadHUD" class="button" id="downloadButton"><span class="w-icon download">Download</span></button>','<span class="file-input" data-tooltip="Open *.vhud file"><span class="btn button-aux"><span class="w-icon open">Open</span><input type="file" name="customHUD" accept=".vhud"></span><span class="file-name hidden">No file selected</span></span>','<button value="loadPreset" class="button-aux" id="loadPresetButton"><span class="w-icon load" data-tooltip="Import Preset <small>(I)</small>">Import</span></button>',"</div>",'<div class="toolbar-main hud-actions">','<button value="undoUpdate" class="button-aux" data-tooltip="Undo <small>(CTRL+Z)</small>"><span class="w-icon icon-undo">Undo</span></button>','<button value="deleteSelected" class="button-aux single-select-button" data-tooltip="Delete <small>(DEL)</small>"><span class="w-icon icon-trash">Delete</span></button>','<button value="cloneSelected" class="button-aux single-select-button" data-tooltip="Clone <small>(CTRL+V)</small>"><span class="w-icon icon-clone">Clone</span></button>','<button value="groupSelected" class="button-aux multi-select-button" data-tooltip="Group <small>(CTRL+G)</small>"><span class="w-icon icon-group">Group</span></button>','<button value="alignSelected" class="button-aux single-select-button popover-action"  data-tooltip="Align" data-popover="align"><span class="w-carret w-icon icon-align">Align</span></button>',"</div>",'<div class="app-stats">','<span class="counter" id="downloadCounterText">0</span>','<span class="hint">custom HUDs <br />have been created so far</span>',"</div>",'<div class="toolbar-aux global-actions">','<button value="sendFeedback" class="button-aux" id="reportBugButton"><span class="w-icon icon-feedback">Feedback</span></button>',"</div>"],events:{"click .popover-action":"showPopover","click .global-actions button":"onGlobalActionButtonClick","click .hud-actions button":"onHUDActionButtonClick","change input[name=customHUD]":"processSelectedFiles"},initialize:function(){this.$el.append(this.htmlTpl.join(""));this.$("#downloadCounterText").text(parseInt(visualHUD.dlCount,10)||0);this.buttons={download:this.$el.find("#downloadButton"),load:this.$el.find("#loadPresetButton"),restart:this.$el.find("#restartAppButton"),report:this.$el.find("#reportBugButton"),singleSelectActions:this.$el.find(".single-select-button"),multiSelectActions:this.$el.find(".multi-select-button")};this.updateToolbarButtonsState(0);this.setupAlignPopOver();this.setupLogoPopOver()},setupAlignPopOver:function(){var a=this.$el.find("button[value=alignSelected]");this.alignPopover=new visualHUD.Widgets.PopOver({cls:"align-popover",events:{},html:visualHUD.Libs.formControlsBuilder.getTemplateByType("alignControl"),position:"bottom-center",title:"Align selected items",scope:this,show:function(){a.addClass("active");visualHUD.toolTips.disable()},hide:function(){a.removeClass("active");visualHUD.toolTips.enable()}});this.alignPopover.$el.on("click",".align-controls li",visualHUD.Function.bind(this.fireAlignAction,this));this.alignPopover.$el.on("mouseenter",".align-popover li",false)},setupLogoPopOver:function(){var a=this.$el.find(".app-logo");this.logoPopover=new visualHUD.Widgets.PopOver({cls:"logo-popover",cancelEventBubbling:false,html:(['<p>Simple yet powerful <a href="http://www.quakelive.com" target="_blank">Quake Live</a> online HUD builder. Simply drag and drop HUD elements to create completely custom Quake Live HUD</p>',"<p>New to visualHUD? Check these useful links!</p>","<ul>",'<li><a href="help/#videos" target="help">Video Tutorials</a></li>','<li><a href="help/#hotkeys" target="help">Hot Keys Cheat Sheet</a></li>','<li><a href="help/#credits" target="help">Credits</a></li>',"</ul>"]).join(""),position:"bottom-center",title:"visualHUD",scope:this,show:function(){a.addClass("active")},hide:function(){a.removeClass("active")}})},setupFeedbackPopOver:function(){var a=this.$el.find("button[value=feedback]");this.feedbackPopover=new visualHUD.Widgets.PopOver({cls:"feedback-popover",cancelEventBubbling:false,html:(['<ul class="popover-menu">','<li><span class="icon icon-feedback"></span><a href="#" class="item-name" data-action="send-feedback">Give a feedback</a></li>','<li><span class="icon icon-bug"></span><a href="#" class="item-name" data-action="report-bug">Report a bug</a></li>',"</ul>"]).join(""),position:"bottom-right",title:"Feedback",scope:this,show:function(){a.addClass("active")},hide:function(){a.removeClass("active")}});this.feedbackPopover.$el.on("click",".popover-menu a",visualHUD.Function.bind(this.fireFeedbackAction,this))},render:function(a){this.$el.appendTo(a.$topArea)},onGlobalActionButtonClick:function(a){var b=a.currentTarget.value;this.trigger("toolbar.global:action",[b])},onHUDActionButtonClick:function(a){var b=a.currentTarget.value;this.trigger("toolbar.hud:action",[b]);return false},showPopover:function(b){var c=$(b.currentTarget),a=c.data("popover"),d=this[a+"Popover"];d.visible?d.hide():d.show(c);return false},fireAlignAction:function(a){var c=$(a.currentTarget),b=c.data("action");this.trigger("align.action",[b]);return false},fireFeedbackAction:function(a){var c=$(a.currentTarget),b=c.data("action");this.trigger("feedback.action",[b])},updateToolbarButtonsState:function(a){this.buttons.singleSelectActions.attr("disabled",a==0);this.buttons.multiSelectActions.attr("disabled",a<=1)},processSelectedFiles:function(b){var a=Array.prototype.slice.call(b.target.files);if(a.length){visualHUD.Libs.importHelper.batchImport(a,{scope:this,files:function(c){this.trigger("load.text",[c,true])}})}b.target.value=""}});visualHUD.Views.viewport.CanvasToolbar=Backbone.View.extend({tagName:"ul",className:"app-toolbar",baseCls:"root-item",menuStructure:[{text:"Screenshot",title:"Change location background",cls:"rtl-item shot-toggle",counter:"hidden",options:[{name:"canvasShot",control:"radio",label:"None",value:0},{name:"canvasShot",control:"radio",label:"Longest Yard",value:1},{name:"canvasShot",control:"radio",label:"Almost Lost",value:2},{name:"canvasShot",control:"radio",label:"Custom Background",value:3}]},{text:"Grid",title:"Toggle grid",cls:"rtl-item grid-toggle",counter:"visible",options:[{name:"drawGrid",control:"radio",label:"Off",value:0},{name:"drawGrid",control:"radio",label:"5px",value:5},{name:"drawGrid",control:"radio",label:"10px",value:10}]},{text:"Snap",title:"Snap element to grid",cls:"rtl-item grid-snap",counter:"visible",options:[{name:"snapGrid",control:"radio",label:"Off",value:0},{name:"snapGrid",control:"radio",label:"5px",value:5},{name:"snapGrid",control:"radio",label:"10px",value:10}]},{text:"Status",title:"",cls:"player-status",counter:"hidden",options:null},{text:"HUD Extras",title:"",cls:"hud-extras",counter:"visible",options:[{control:"checkbox",value:1,name:"lagometr",label:"Lagometr"},{control:"checkbox",value:1,name:"speedometr",label:"Speedometr"},{control:"checkbox",value:1,name:"pickup",label:"Item Pickup"},{control:"checkbox",value:1,name:"recordingMessage",label:"Demo Recording Message"}]},{text:"Gun",title:"",cls:"draw-gun",counter:"visible",options:[{name:"drawGun",control:"radio",label:"Hidden",value:0},{name:"drawGun",control:"radio",label:"Right",value:1},{name:"drawGun",control:"radio",label:"Center",value:2}]},{text:"Weapon bar",title:"",cls:"weapong-bar",counter:"visible",options:[{name:"drawWeaponbar",control:"radio",label:"Hidden",value:0},{name:"drawWeaponbar",control:"radio",label:"Right",value:2},{name:"drawWeaponbar",control:"radio",label:"Left",value:1},{name:"drawWeaponbar",control:"radio",label:"Bottom",value:3},{name:"drawWeaponbar",control:"radio",label:"Q3A Style",value:4}]},{text:"Team overlay",title:"",cls:"tm-overlay",counter:"visible",options:[{name:"drawTeamoverlay",control:"radio",label:"Hidden",value:0},{name:"drawTeamoverlay",control:"radio",label:"Top",value:1},{name:"drawTeamoverlay",control:"radio",label:"Bottom",value:2}]}],events:{"click input":"changeCanvasOption","change .player-status input[type=text]":"changeCanvasOption","click .player-status form":"stopPropagation","click li.root-item ul":"onSubmenuClick","click li.root-item":"onRootitemClick","mouseover li.root-item ul":"stopPropagation"},initialize:function(){this.tpl=["<% _.each(items, function(item) { %>",'<li class="<%= baseCls %> <%= item.cls %>" data-tooltip="<%= item.title %>">','<span class="item-name"><%= item.text %></span>','<strong class="item-value <%= item.counter %>">0</strong>',"<% if(item.options && item.options.length){ %>","<ul>","<% _.each(item.options, function(option) { %>","<li>",'<label><input type="<%= option.control %>" name="<%= option.name %>" value="<%= option.value %>" /><span><%= option.label %></span></label>',"</li>","<% }); %>","</ul>","<% }; %>","</li>","<% }); %>"];this.menuStructure.splice(0,0,{text:"View",title:"Filter Elements by Game Type",cls:"rtl-item gt-filter",counter:"hidden",options:this.getGameTypeFilterOptions()});this.options.clientSettingsModel.on("change",this.setClientSettings,this)},getGameTypeFilterOptions:function(){var a=[];_.each(visualHUD.Libs.formBuilderMixin.getByName("base").getOwnerDrawOptions(),function(c,b){a.push({name:"ownerDrawFlag",control:"radio",label:c,value:b})});return a},render:function(a){var b=_.template(this.tpl.join(""),{baseCls:this.baseCls,items:this.menuStructure});this.$el.append(b);this.renderPlayerStatusControls();this.renderImageImportMenuItem();var c=this.options.clientSettingsModel;this.setClientSettings(c.toJSON());this.$el.appendTo(a.$bottomtArea)},renderPlayerStatusControls:function(){var d=this.$el.find(".player-status");var b=$("<form />");var a=this.options.clientSettingsModel;var c=[];c.push(visualHUD.Libs.formControlsBuilder.createRangeInput({type:"rangeInput",name:"statusHealth",label:"Health",min:0,max:200,value:a.get("statusHealth")}));c.push(visualHUD.Libs.formControlsBuilder.createRangeInput({type:"rangeInput",name:"statusArmor",label:"Armor",min:0,max:200,value:a.get("statusArmor")}));c.push(visualHUD.Libs.formControlsBuilder.createRangeInput({type:"rangeInput",name:"statusAmmo",label:"Ammo",min:0,max:150,value:a.get("statusAmmo")}));c.push(visualHUD.Libs.formControlsBuilder.createRangeInput({type:"rangeInput",name:"statusSkill",label:"Skill",min:0,max:100,value:a.get("statusSkill")}));_.each(c,function(e){b.append(e)});d.append(b)},renderImageImportMenuItem:function(){var c=this.$el.find("li.shot-toggle ul"),b=(['<a href="#" class="set-custom-bg">',"Import image","</a>"]).join(""),d=$("<li />").html(b).appendTo(c),a=d.find("a.set-custom-bg");a.click(visualHUD.Function.bind(function(e){this.trigger("import.image");e.preventDefault()},this))},onRootitemClick:function(b){b.preventDefault();var a=$(b.currentTarget);var d=this.$el.children();var f=d.filter(".active").not(a).removeClass("active");var e=null;a.toggleClass("active");e=a.hasClass("active");this.trigger("toolbar.menu:show",[this]);var c=visualHUD.Function.bind(this.hideMenu,this);if(e&&f.length==0){window.setTimeout(function(){$("body").bind("click.hideMenu",c)},20)}else{if(!e&&f.length==0){$("body").bind("click.hideMenu",c)}else{b.stopPropagation()}}},hideMenu:function(){var a=this.$el.children();a.filter(".active").removeClass("active");$("body").unbind("click.hideMenu");this.trigger("toolbar.menu:hide",[this])},onSubmenuClick:function(a){a.stopPropagation();this.hideMenu()},changeCanvasOption:function(d){var e=d.currentTarget;var a=$(e);var c=a.is("[type=checkbox]");if(e.name!=""){var b=this.options.clientSettingsModel;b.set(e.name,c?e.checked:e.value)}},setClientSettings:function(d){if(d instanceof Backbone.Model){d=d.attributes}var h,e,f,a,c,g;for(var i in d){h=d[i];a=_.template("input[name=<%= name %>]",{name:i});g=this.$el.find(a);if(h===true){g.attr("checked",h)}else{c=_.template("input[value=<%= name %>]",{name:h});g=g.filter(c);g.attr("checked",true);var b=g.closest("li.root-item").find("strong.item-value").text(h)}}},stopPropagation:function(a){a.stopPropagation();return false}});visualHUD.Views.viewport.Canvas=Backbone.View.extend({className:"hud-canvas",tagName:"div",htmlTpl:['<div class="canvas-extras">','<div class="hud-weapon"></div>','<div class="hud-crosshair"></div>','<div class="weapon-bar"></div>','<div class="team-overlay"></div>','<div class="lag-o-metr"></div>','<div class="speed-o-metr"></div>','<div class="pickup-message"></div>','<div class="demo-rec-message"></div>',"</div>",'<div class="hud-elements">',"</div>"],clientSettingsMap:{lagometr:{"1":"draw-lag"},speedometr:{"1":"draw-speed"},pickup:{"1":"draw-pickup"},recordingMessage:{"1":"draw-demo-rec"},drawGrid:{"0":"no-grid","5":"grid-5","10":"grid-10"},drawGun:{"0":"no-gun","1":"gun-1","2":"gun-2"},drawWeaponbar:{"0":"no-gun","1":"wbar-1","2":"wbar-2","3":"wbar-3","4":"wbar-4"},drawTeamoverlay:{"0":"no-teamoverlay","1":"teamoverlay-1","2":"teamoverlay-2"}},events:{mousedown:"checkDragAction"},initialize:function(){_.extend(this,visualHUD.Libs.selectionManagerInterface);this.initializeDragManager()},render:function(a){this.viewport=a;this.$el.append(this.htmlTpl.join(""));this.getRefs();this.$el.appendTo(a.$centerArea);var b=this.options.clientSettingsModel;b.changed=b.toJSON();this.setClientSettings(b);b.on("change",this.setClientSettings,this)},getRefs:function(){this.$HUDextras=this.$el.find(".canvas-extras");this.$canvas=this.$el.find(".hud-elements")},setClientSettings:function(a){var b=this.clientSettingsMap;_.each(a.changed,function(g,e){if(e=="snapGrid"){this.dragManager.setOptions({grid:Math.max(parseInt(g,10)*visualHUD.scaleFactor,visualHUD.scaleFactor)})}if(e=="canvasShot"){var i=this.$el.parent().attr("class");i=i.replace(/canvas-[0-9]/,"");i=$.trim(i)+" canvas-"+g;this.$el.parent().attr("class",i);if(g<3){this.$customImage&&this.$customImage.hide()}else{if(g==3){this.setCustomBackground()}}return}if(e=="ownerDrawFlag"){var h=a._previousAttributes[e]||"";this.$el.parent().removeClass("gt-"+h.toLowerCase()).addClass("gt-"+g.toLowerCase())}var d=this.clientSettingsMap[e];if(d){var f="removeClass";for(var c in d){f=g==c?"addClass":"removeClass";this.$el[f](d[c])}}},this)},initializeDragManager:function(){var a=this;this.dragManager=new visualHUD.Utils.DragZoneBase({ticks:0,tolerance:2,grid:visualHUD.scaleFactor,view:this});_.extend(this.dragManager,visualHUD.Libs.canvasDragInterface)},checkDragAction:function(d){var a=$(d.target);var b=a.closest(".hud-item",this.$el);var c=a.closest("div.resize-handle",this.$el);if(this.viewport.canvasDragMoveAllowed==true){return}else{if(c.length){this.dragManager.setMode("resize").start(d,c);return false}if(b.length){this.dragManager.setMode("move").start(d,b);return false}else{this.dragManager.setMode("select").start(d);return false}}},deselectItem:function(a){this.deselect();return false},getCanvasOffset:function(){var c=this.$canvas.offset(),b={width:this.$canvas.width(),height:this.$canvas.height()},a={top:c.top,left:c.left,right:c.left+b.width,bottom:c.top+b.height};_.extend(a,b);return a},beginUpdate:function(){this.$el.addClass("hud-items-hidden")},completeUpdate:function(){this.$el.removeClass("hud-items-hidden");this.$el.find("div."+visualHUD.Views.HUDItem.prototype.className).each(function(a){var b=$(this).data("HUDItem");b.refreshCoordinates()})},setCustomBackground:function(){var a=this.options.clientSettingsModel;var c=a.previous("canvasShot");var d=a.get("customBackground");this.$customImage=this.$customImage||$("<img/>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"none"}).prependTo(this.$el);if(d){this.$customImage.attr("src",d).show()}else{if(visualHUD.growl){var b=visualHUD.growl.alert({status:"warning",title:"No custom image",message:'Custom background was not imported yet. Would you like to <a href="#" class="import">import</a>?'});b.find("a.import").click(visualHUD.Function.bind(function(){this.trigger("import.image");visualHUD.growl.hide(b);return false},this))}visualHUD.Function.createDelayed(function(e,g){var f={};f[e]=g;a.set(f);this.viewport.getCanvasToolbarView().setClientSettings(f)},10,this,["canvasShot",c])()}},updateIndexes:function(){var c=this.$canvas.children(),b=c.length,a;c.each(function(d){a=c.eq(d).data("HUDItem");a.model.set("index",d)})}});visualHUD.Views.viewport.StageControls=Backbone.View.extend({tagName:"div",className:"stage-controlls-area",collection:null,htmlTpl:['<div class="sidebar-block" id="getStartedTextarea">',"<h3>Get started</h3>",'<div class="mb-10">',"Use icons below to build your HUD. Drag and drop items or simple double click on icon to create new HUD element","</div>","<div>",'<a href="help/#videos" target="help" class="mr-20">View Video Tutorials</a>',"</div>","</div>",'<div class="sidebar-block stage-controls" id="stageControlsArea">',"<h4>HUD Elements</h4>",'<ul class="library-items clearfloat">',"</ul>","</div>",'<div class="sidebar-block stage-controls" id="editorSettingsArea">',"<h4>Editor Size and Layout</h4>",'<ul class="library-items icons-32px viewport-size-controls ctrl-group clearfloat">','<li data-viewportsize="1" data-tooltip="Normal<small>640x480</small>" class="ctrl normal-viewport"><span class="item-name">Normal</span></li>','<li data-viewportsize="2" data-tooltip="Doubled<small>1280x960</small>" class="ctrl doubled-viewport"><span class="item-name">Doubled</span></li>',"</ul>",'<ul class="library-items icons-32px viewport-layout-controls ctrl-group clearfloat">','<li data-layout="false" data-tooltip="Full Layout" class="ctrl normal-layout"><span class="item-name">Normal</span></li>','<li data-layout="true" data-tooltip="Compact Layout" class="ctrl compact-layout"><span class="item-name">Doubled</span></li>',"</ul>","</div>"],stageControlTpl:['<li class="<%= cssClass %>"  id="<%= id %>" data-id="<%= id %>" data-tooltip="<%= label %>">','<span class="item-name"><%= label %></span>',"</li>"],events:{"mousedown #stageControlsArea li":"startDrag","dblclick #stageControlsArea li":"dropHUDItem","click .viewport-size-controls li":"switchEditorSize","click .viewport-layout-controls li":"switchEditorLayout","mouseenter .viewport-size-controls li":"exposeEditor","mouseleave .viewport-size-controls li":"maskEditor"},initialize:function(){var a=[];this.collection.each(function(b){a.push(_.template(this.stageControlTpl.join(""),{id:b.get("id"),label:b.get("label"),cssClass:b.get("cssClass")}))},this);this.$el.append(this.htmlTpl.join(""));this.$("#stageControlsArea").find("ul.library-items").append(a.join(""));this.setupDragManager()},render:function(a){this.viewport=a;this.$el.appendTo(a.$sidebarArea)},setupDragManager:function(){var b,a;this.dragManager=new visualHUD.Utils.DragZoneBase({scope:this,ticks:2,tolerance:3,position:"offset",bodyDragClass:"new-item-drag",init:function(c){c.ghost.addClass("stage-controls-drag-helper")},onbeforestart:function(){b=this.viewport.getCanvasView().getCanvasOffset();a=this.viewport.$centerArea},onstart:function(d){var c={left:d.mouse.x+d.moveOffset.x,top:d.y+d.moveOffset.y,display:"block"};d.ghost.addClass(d.currentElement[0].className).css(c);d.currentElement.addClass("drag-start")},ondrag:function(e,f,c,d){e.ghost.css(c);if(b.top<d.y&&b.left<d.x&&b.right>d.x&&b.bottom>d.y){if(!a.hasClass("new-item-drop-over")){a.addClass("new-item-drop-over")}}else{if(a.hasClass("new-item-drop-over")){a.removeClass("new-item-drop-over")}}},ondrop:function(g,h,d){var e=g.currentElement.data().id;var c=this.collection.get(e);var f=g.getMouse(h);var i=b.top<f.y&&b.left<f.x&&b.right>f.x&&b.bottom>f.y;g.ghost.removeClass(g.currentElement[0].className);g.currentElement.removeClass("drag-start");a.removeClass("new-item-drop-over");if(i){this.trigger("item.drop",[c,{top:Math.round(f.y-b.top),left:Math.round(f.x-b.left)}])}}})},startDrag:function(b){var a=$(b.currentTarget);if(a.hasClass("disabled")){return false}this.dragManager.start(b,a);if(b.stopPropagation){b.stopPropagation()}if(b.preventDefault){b.preventDefault()}return false},dropHUDItem:function(d){var a=$(d.currentTarget),e=a.data().id,b=this.collection.get(e),c=this.viewport.getCanvasView().getCanvasOffset();if(a.hasClass("disabled")){return false}this.trigger("item.drop",[b,{top:Math.round(c.height/2),left:Math.round(c.width/2)}])},switchEditorSize:function(b){var a=$(b.currentTarget),c=parseInt(a.data("viewportsize"),10);this.trigger("scalefactor.change",[c])},exposeEditor:function(){var a=this.viewport.$centerArea;a.addClass("new-item-drop-over")},maskEditor:function(){var a=this.viewport.$centerArea;a.removeClass("new-item-drop-over")},switchEditorLayout:function(c){var a=$(c.currentTarget),b=a.data("layout");this.trigger("layout.change",[b])},updateControlsStatus:function(e,b){var d=this.$("#"+b),a=this.collection.get(b),f=a.get("isSingle"),c="addClass";switch(e){case"create":c="addClass";break;case"destroy":c="removeClass";break}f&&d[c]("disabled")}});visualHUD.Views.HUDItem=Backbone.View.extend({tagName:"div",className:"hud-item",events:{click:"itemClick"},initialize:function(){var c=visualHUD.Libs.itemBuilderMixin.getByType("general"),a=visualHUD.Libs.itemBuilderMixin.getByType(this.model.get("itemType")),b=visualHUD.Libs.itemBuilderMixin.getByName(this.model.get("name"));if(c==a){a={}}_.extend(this,c,a||{},b||{});this.$el.data("HUDItem",this);this.model.on("change",this.onModelUpdate,this);this.model.on("destroy",this.onModelDestroy,this);this.model._HUDItem=this;this.delayedStatusUpdate=visualHUD.Function.createBuffered(this.refreshCoordinates,10,this);this.render()},render:function(){var h=this.options.renderTo,b=this.prepareTemplate();var g=this.model.get("coordinates");var c=this.model.get("resizable");this.$el.addClass(this.options.htmlTplRecord.get("cssClass"));this.$el.append(b);this.$el.css({visibility:"hidden"});if(this.model.get("resizable")==true){this.appendResizehandles()}this.getDOMRefs();_.each(this.model.attributes,function(i,j){i!=null&&this.callUpdateMethodByField(j,false)},this);this.$el.appendTo(h);var d=g.width,a=g.height,f=this.model.wasDropped?g.top-this.$el.height()/2:g.top*visualHUD.scaleFactor,e=this.model.wasDropped?g.left-this.$el.width()/2:g.left*visualHUD.scaleFactor;this.$el.css({width:this.model.get("width")*visualHUD.scaleFactor||"auto",height:this.model.get("height")*visualHUD.scaleFactor||"auto",top:Math.round(f),left:Math.round(e)});this.refreshCoordinates();this.getForm().render();this.$el.css({visibility:""})},prepareTemplate:function(){var f=this.model.toJSON(),e=this.options.htmlTplRecord,b=e.get("template").join(""),d=this.getIconOptions(),a=d?d[this.model.get("iconStyle")]:null,c;f.icon=this.model.get("iconStyle")!=null?a:d;c=_.template(b,f);return c},appendResizehandles:function(){var a=[];_.each(["nw","n","ne","e","se","s","sw","w"],function(b){a.push('<div class="resize-handle '+b+'" data-resizeDirection="'+b+'"></div>')});this.$el.append(a.join(""))},getDOMRefs:function(){var a=this.refs;if(!a){this.refs={layoutBox:this.$el.find("div.hud-item-layout"),iconBlock:this.$el.find("div.item-icon"),icon:this.$el.find("div.item-icon img"),textBlock:this.$el.find("div.item-counter"),counter:this.$el.find("div.item-counter span.counter"),templateText:this.$el.find("div.item-counter span.text"),box:this.$el.find(".hud-item-box"),h100:this.$el.find(".hud-item-box div.h100"),h200:this.$el.find(".hud-item-box div.h200"),chatList:this.$el.find("ul.chat-messages")}}return a},getForm:function(){return this.options.formView},getIconOptions:function(){var c=this.options.HUDItemIconEnums,a=c.get(this.model.get("name")),b=a?a.get("options"):null;return b},onModelDestroy:function(){this.remove();this.getForm().remove();this.options.formView=null;this.trigger("destroy",[this.model])},onModelUpdate:function(a,c){var b=c.changes;_.each(b,function(f,e){var d=e.match(/coordinates|width|height|padding|textSize|iconSize|iconSpacing|iconPosition/gi)!=null;f&&this.callUpdateMethodByField(e,d)},this)},callUpdateMethodByField:function(e,b){var d=this.model.get(e),a="update"+e.charAt(0).toUpperCase()+e.substring(1),c=this[a];if(_.isFunction(c)){c.call(this,d);(b===true)&&this.delayedStatusUpdate(true)}},refreshCoordinates:function(b){if(this.$el.is(":visible")){var a=this.$el.position(),c={top:Math.round(a.top/visualHUD.scaleFactor),left:Math.round(a.left/visualHUD.scaleFactor),height:Math.round(this.$el.height()/visualHUD.scaleFactor),width:Math.round(this.$el.width()/visualHUD.scaleFactor)};this.model.set("coordinates",c,{silent:b});(b==true)&&this.getForm().updateStatusBar();return c}},move:function(c,d){var a=this.$el.position();a[c]+=d;var b=this.checkPosition(a);this.$el.css(b);this.refreshCoordinates()},checkPosition:function(a){var d=this.$el;var e=d.offsetParent();var c=this.limits||{top:0,left:0,right:e.width(),bottom:e.height()};this.limits=c;var b={width:d.width(),height:d.height()};if(a.left+b.width>c.right){a.left=c.right-b.width}if(a.top+b.height>c.bottom){a.top=c.bottom-b.height}a.left=Math.round(a.left<0?0:a.left);a.top=Math.round(a.top<0?0:a.top);return a},itemClick:function(a){this.trigger("click",[this,a])},getGroup:function(){return this.model.get("group")},setGroup:function(a){this.model.set("group",a||null)},update:function(b){var a=this.getForm();this.model.set(b);a.setValues(b,{silent:true})},updateCoordinates:function(a){this.$el.css({top:a.top*visualHUD.scaleFactor,left:a.left*visualHUD.scaleFactor})},updateTextSize:function(a){},updateTextStyle:function(a){},updateTextOpacity:function(a){},updateIconPosition:function(a,b){},updateIconOpacity:function(a){},updateIconSize:function(a){},updateIconStyle:function(a){},updateIconSpacing:function(a){},updateTextColor:function(a){},updateTeamColors:function(a){},updateColorRanges:function(a){},updateText:function(a){},updateBorderRadius:function(a){},updateBoxStyle:function(a){},updateTemplate:function(a){},updatePowerupView:function(a){},updatePadding:function(a){},updateToggleChat:function(a){},updateScoreboxLayout:function(a){}});visualHUD.Views.HUDItemForm=Backbone.View.extend({tagName:"form",className:"app-form",basicTpl:['<div class="control-header">','<div class="header-wrap <%= className %>">','<span class="item-type">Item:</span>','<div class="item-name"><%= label %></div>',"</div>","</div>",'<div class="app-form-container">','<div class="app-form-controls">',"</div>","</div>",'<div class="form-bbar">','<div class="item-status">',"</div>","</div>"],statusBarTpl:['<span class="mr-10">','<span class="item-name">X:</span>','<span class="item-value"><%= left %></span>',"</span>",'<span class="mr-10">','<span class="item-name">Y:</span>','<span class="item-value"><%= top %></span>',"</span>",'<span class="mr-10">','<span class="item-name">W:</span>','<span class="item-value"><%= width %></span>',"</span>",'<span class="mr-10">','<span class="item-name">H:</span>','<span class="item-value"><%= height %></span>',"</span>"],events:{submit:"preventSubmit","click legend":"toggleFieldsetCollapse",change:"onChange","click .align-controls li":"alignItems","click .arrange-controls li":"arrangeItems"},initialize:function(){var d=visualHUD.Libs.formBuilderMixin.getByType("base"),a=visualHUD.Libs.formBuilderMixin.getByType(this.model.get("itemType")),c=visualHUD.Libs.formBuilderMixin.getByName(this.model.get("name"));_.extend(this,d,a||{},c||{});_.extend(this,visualHUD.Libs.formControlsBuilder);var b=_.template(this.basicTpl.join(""),{className:this.model.get("cssClass"),label:this.model.get("label")});this.$el.append(b);this.hide();this.model.on("change:coordinates",this.updateStatusBar,this);$(window).bind("resize.form",$.proxy(this,"trackResize"))},render:function(){var a=this.options.renderTo;this.$el.appendTo(a);this.trackResize();this.updateStatusBar();visualHUD.Libs.colorHelper.setupColorPicker(a);this.createControls(this.$el.find(".app-form-controls"))},trackResize:function(){var b=this.$el.parent(),a=b.height();this.$el.height(a)},updateStatusBar:function(){var b=this.model.get("coordinates");var a=_.template(this.statusBarTpl.join(""),b);this.$el.find(".item-status").html(a)},getCollection:function(a){return this.options.collections[a]||null},onChange:function(c){var a=c.target.name;if(a&&c.silent!==true){var e=$(c.target);var d=e.is("[type=checkbox]")?e.get(0).checked:e.val();var b=a.match(/^colorRange/);if(b){d=this.getColorRangeChanges(a,d);a="colorRanges"}this.model.set(a,d)}return},getColorRangeChanges:function(d,h){var c=d.split("_");var f=parseInt(c[1],10);var e=parseInt(c[3],10);var b=Array.prototype.slice.call(this.model.get("colorRanges"));var a=_.clone(b[f]);var g=Array.prototype.slice.call(a.range);b[f]=a;a.range=g;if(c[2]=="range"&&e!==undefined){g[e]=parseInt(h,10)}else{if(c[2]=="color"){a.color=h}}return b},preventSubmit:function(a){a.preventDefault()},getValues:function(){var b=/select|textarea/i;var a=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i;var c=this.$el.find("input,select,textarea");return this.$el.map(function(){return jQuery.makeArray(c)}).filter(function(){return this.name&&!this.disabled&&(this.checked||b.test(this.nodeName)||a.test(this.type))}).map(function(e,f){var d={};d[f.name]=jQuery(this).val();return d}).get()},setValues:function(b,a){var a=a||{};_.each(b,function(e,c){var f=this.$el.find("[name="+c+"]");if(f.length){var d=jQuery.Event("change");d.silent=a.silent||false;f.val(e).trigger(d)}},this)},toggleFieldsetCollapse:function(b){var c=$(b.target);var a=c.closest("fieldset",this.$el);a.toggleClass("collapsed")},alignItems:function(a){var c=$(a.currentTarget),b=c.data("action");this.trigger("align.action",[b]);return false},arrangeItems:function(a){var c=$(a.currentTarget),b=c.data("action");this.trigger("arrange.action",[b]);return false},createControls:function(){}});visualHUD.Views.WindowBase=Backbone.View.extend({tagName:"div",className:"xpk-window",opened:false,rendered:false,defaults:{width:500,height:"auto"},mixin:[],htmlTpl:['<div class="xpk-mwindow-wrap">','<div class="xpk-mwindow-content">','<div class="xpk-win-head clearfloat">',"<h3><%= title %></h3>",'<a href="#" class="xpk-close-button">&times;</a>',"</div>",'<div class="xpk-win-content clearfloat">',"<%= html %>","</div>","</div>","</div>"],initialize:function(b){var a=[this];this.options=_.extend({},this.defaults,b);_.each(this.mixin,function(d){a.push(Backbone.resolveNamespace(d))});if(this.mixin.length){_.extend.apply(_,a)}var c=_.template(this.htmlTpl.join(""),{title:this.options.title||"Modal Window",html:this.html||this.options.html||""});this.$el.append(c);this.getRefs();this.bindEvents();this.init();this.render()},init:function(){},render:function(){this.$el.css({display:"none"}).appendTo(document.body);this.rendered=true;this.trigger("render",this)},getRefs:function(){this.$contentWrapper=this.$el.find("div.xpk-mwindow-wrap");this.$content=this.$el.find("div.xpk-win-content");this.$title=this.$el.find(".xpk-win-head h3");this.$closeButton=this.$el.find(".xpk-close-button");this.$closeButton.click($.proxy(this.hide,this));this.$el.click($.proxy(this.cancelEventBubbling,this))},bindEvents:function(){if(this.options.show){this.on("show",this.options.show,this)}if(this.options.hide){this.on("hide",this.options.hide,this)}if(this.options.cancel){this.on("hide",this.options.cancel,this)}},setTitle:function(a){this.$title.html(a)},update:function(a){this.$content.empty().append(a)},show:function(){var b=this.options.width;var a=this.options.height;this.$contentWrapper.css({width:b});this.$el.css({visibility:"hidden",display:"block"});var d=this.$contentWrapper.height();this.$contentWrapper.addClass("xpk-win-show");this.$el.css({marginTop:-1*d/2+"px",visibility:"visible"});var c=visualHUD.Function.createDelayed(this.animateWindow,10,this);c();$.showModalOverlay(200,0.7);return this},hide:function(a){this.$el.css({display:"none"});$.hideModalOverlay();this.opened=false;$(window).unbind("resize.reposition");$(document).unbind("keyup.keyboardListiner");this.trigger("hide",[this]);if(a instanceof jQuery.Event){a.preventDefault()}return this},getTopPosition:function(b){var d=[];var a=$(document.body).height();var c=$(window).scrollTop();d[0]=Math.round(a/2-b[0]/2);d[0]+=c;d[1]=Math.round(a/2-b[1]/2);d[1]+=c;if(d[1]<0){d[1]=0}return d},animateWindow:function(c,a,d){this.$contentWrapper.removeClass("xpk-win-show");this.opened=true;this.trigger("show",[this]);var i=visualHUD.Function.createBuffered(this.reposition,200,this);var b=visualHUD.Function.bind(this.keyboardListiner,this);$(window).bind("resize.windowReposition",i);$(document).bind("keyup.windowKeyboardListiner",b);return;var h=this;var e=250;var g=jQuery.easing.easeOutExpo?"easeOutExpo":"swing";var f=this.$contentWrapper;var j=this.options;var i=visualHUD.Function.createBuffered(this.reposition,200,this);var b=visualHUD.Function.bind(this.keyboardListiner,this);this.$el.css({overflow:"hidden",visibility:"visible",height:"auto",top:d[0]});f.animate({width:c,height:a},{easing:g,duration:e,complete:function(){f.removeClass("xpk-win-show").css({height:j.height});h.opened=true;h.trigger("show",[h]);$(window).bind("resize.windowReposition",i);$(document).bind("keyup.windowKeyboardListiner",b);i()}});this.$el.animate({top:d[1]},{easing:g,duration:e});return this},reposition:function(){return;if(this.$el.is(":visible")){var b=$(document.body).height();var a=this.$el.height();var c=this.getTopPosition([0,a]);a=a>b?b:"auto";this.$el.css({overflow:"auto",height:a,top:c[1]})}},keyboardListiner:function(a){if(a.keyCode==27){this.trigger("cancel",[this])}},cancel:function(){this.trigger("cancel",[this])},cancelEventBubbling:function(a){a.stopPropagation()},serializeForm:function(){return this.$content.serializeForm()}});(function(a){})(jQuery);visualHUD.Views.windows.Download=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"click button[name=downloadHUD]":"beginDownload","click button[name=cancel]":"hide","change input[name=hud_name]":"validateName","keyup input[name=hud_name]":"validateNameBuffered"},html:(['<div class="mb-20">',"<p>You are about to download your custom HUD. Please, name it and click [Download] button. </p>",'Don\'t know how to use a custom HUD? Check out holysh1t\'s custom <a href="http://www.holysh1t.net/quakelive-custom-hud-install-guide/" target="_blank">HUD install guide</a>.',"</div>"]).join(""),init:function(){var a=this.buildForm([{type:"form",cssClass:"mwin-form",id:"downloadHUDForm",action:visualHUD.ACTION_DOWNLOAD_HUD,method:"post",items:[{type:"textbox",name:"hud_data",inputType:"hidden",wrap:false},{type:"textbox",name:"hud_name",label:"HUD name",size:32,maxlength:128,value:"",hint:"HUD name should be at least 3 characters length and contain only letters and numbers"},{type:"checkbox",name:"save_preset",tooltip:"All custom presets are available from the Import dialog",boxLabel:"Save as custom preset",checked:true},{type:"toolbar",cssClass:"pt-10",items:[{type:"button",text:"Download",icon:"download",role:"main",action:"submit",name:"downloadHUD"},{type:"button",text:"Cancel",role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(a);this.validateNameBuffered=visualHUD.Function.createBuffered(this.validateName,200,this);this.on("show",this.setFocus,this);this.on("cancel",this.hide,this)},setSavePresetCheckboxLabel:function(c){var b=this.$content.find("[name=save_preset]"),a=b.next(".box-label");if(c){a.text("Update saved custom preset")}else{a.text("Save as custom preset")}return this},setHUDName:function(a){if(a){this.$el.find("input[name=hud_name]").val(a)}return this},beginDownload:function(){try{var b=this.$el.find("input[name=hud_name]").val(),c=this.collection.serialize(),a={name:b,items:c};this.setHUDData(a);this.on("download",[this,a]);this.hide()}catch(d){throw (d.message);return false}},setFocus:function(){this.$el.find("input[name=hud_name]").focus();this.validateName()},validateName:function(){var a=this.$textbox||this.$content.find("input[name=hud_name]").get(0);var b=this.$submitButton||this.$content.find("button[name=downloadHUD]");this.$submitButton=b;this.$textbox=a;var c=a.value.length&&(/^[aA-zZ_\-0-9\.]{3,128}$/).test(a.value);b.attr("disabled",c==false)},getForm:function(){var a=this.$form;if(a==undefined){this.$form=a=this.$("#downloadHUDForm")}return a},setHUDData:function(a){if(_.isString(a)==false){a=JSON.stringify(a)}this.$el.find("input[name=hud_data]").val(a)}});visualHUD.Views.windows.ImportHUD=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"click button[name=loadHUD]":"loadHUD","click button[name=cancel]":"hide","click button[name=downloadPresets]":"downloadPresets","keyup textarea[name=hud_json]":"validateHUDJsonBuffered","keyup input[name=preset_filter]":"filterPresetsBuffered","change input[name=preset_filter]":"filterPresets","change form":"updateFormStatus","change input[name=myCustomPreset]":"processSelectedFiles"},html:(['<div class="mb-20">','To add more presets, click [Browse For Presets...] button and choose <code><strong>*.vhud</strong></code> files to import. Also you can simply drag and drop these files right into the browser window.<a href="help/#import" target="help" class="ml-10">Learn more</a>',"</div>"]).join(""),init:function(){this.createDlPresetForm();this.createImportForm();this.bindExtraEvents();this.setDlPresetButtonState();this.customHUDPresetsList=this.$("#customHUDList").data("component")},importPredefined:function(){this.$el.find("[value=predefined]").attr("checked",true);this.showPredefinedHUDPresets();this.show()},importCustom:function(){this.$el.find("[value=custom]").attr("checked",true);this.showCustomHUDPresets();this.show()},bindExtraEvents:function(){this.validateHUDJsonBuffered=visualHUD.Function.createBuffered(this.validateHUDJson,200,this);this.filterPresetsBuffered=visualHUD.Function.createBuffered(this.filterPresets,200,this);var b=visualHUD.Function.createBuffered(this.onListUpdate,250,this);this.options.customPresetsCollection.on("add",b);this.options.customPresetsCollection.on("remove",b);this.options.customPresetsCollection.on("all",this.setDlPresetButtonState,this);var a=this.$el.find("[name=preset_filter]").get(0);this.on("show",a.focus,a);this.on("show",this.validateHUDJson,this);this.on("hide",this.reset,this);this.on("load",this.hide,this);this.on("cancel",this.hide,this)},importPredefinedHUD:function(b,c,a,d){if(a==undefined){return true}var f=$(d.target).closest("li.action",c);if(f.length){var e=f.data("action");switch(e){case"delete":b.collection.remove(a);break;case"download":this.trigger("download.preset",[a.attributes]);break}}else{this.trigger("load",[a.attributes])}},toggleNameField:function(b){var a=this.$nameField||this.$("#HUDNameTextbox");if(b){this.$nameField=a.removeClass("hidden");a.find("input").val("").get(0).focus()}else{this.$nameField=a.addClass("hidden");a.find("input").val("")}this.reposition()},showCustomHUDControl:function(){var b=this.$customHUDControl||this.$("#customHUDControl");var a=this.$predefinedHUDPresets||this.$("#predefinedHUDPresets");var c=this.$customHUDPresets||this.$("#customHUDPresets");this.$customHUDControl=b.removeClass("hidden");this.$predefinedHUDPresets=a.addClass("hidden");this.$customHUDPresets=c.addClass("hidden");this.reposition();this.$el.find("[name=hud_json]").focus().select()},showPredefinedHUDPresets:function(){var b=this.$customHUDControl||this.$("#customHUDControl");var a=this.$predefinedHUDPresets||this.$("#predefinedHUDPresets");var c=this.$customHUDPresets||this.$("#customHUDPresets");this.$customHUDControl=b.addClass("hidden");this.$predefinedHUDPresets=a.removeClass("hidden");this.$customHUDPresets=c.addClass("hidden");this.reposition()},showCustomHUDPresets:function(){var b=this.$customHUDControl||this.$("#customHUDControl");var a=this.$predefinedHUDPresets||this.$("#predefinedHUDPresets");var c=this.$customHUDPresets||this.$("#customHUDPresets");this.$customHUDControl=b.addClass("hidden");this.$predefinedHUDPresets=a.addClass("hidden");this.$customHUDPresets=c.removeClass("hidden");this.$el.find("[name=preset_filter]").focus();this.reposition()},validateHUDJson:function(){var a=this.$textarea||this.$content.find("[name=hud_json]").get(0);var c=this.$content.find("[name=presetType]:checked");var h=c.val();var b=this.$submitButton||this.$content.find("button[name=loadHUD]");this.$submitButton=b;this.$textbox=a;var g=false;if(h=="custom"){try{var d=JSON.parse(a.value);if(_.isArray(d)){g=d.length}else{if(_.isObject(d)){g=d.items.length;if(d.name){this.toggleNameField(true);this.$el.find("[name=hud_name]").val(d.name);this.$el.find("[name=save_preset]").attr("checked",true)}}}}catch(f){}}b.attr("disabled",g==false)},filterPresets:function(b){var c=b.target.value,a=new RegExp(c,"gi");this.options.customPresetsCollection.each(function(d){var e=this.customHUDPresetsList.getElementByModel(d);if(d.get("name").match(a)==null){e.hide()}else{e.show()}},this)},updateFormStatus:function(d){var c=$(d.currentTarget);var a=this.serializeForm();var b=d.target.name;switch(a[b]){case"predefined":this.showPredefinedHUDPresets();break;case"custom":this.showCustomHUDPresets();break}switch(b){case"save_preset":this.toggleNameField(!!a[b]);break}this.validateHUDJson()},reset:function(){this.$content.find("form").get(0).reset();this.showCustomHUDPresets();this.$content.find("[name=presetType][value=custom]").attr("checked",true)},cancel:function(){this.hide()},loadHUD:function(){var a=this.serializeForm(),c,d,b=a.hud_name;switch(a.presetType){case"custom":try{d=JSON.parse(a.hud_json)}catch(f){visualHUD.growl.alert({status:"error",title:"Invalid HUD Preset",message:visualHUD.messages.HUD_PARSE_ERROR})}break}if(_.isArray(d)&&d.length){this.trigger("load",[{name:b,items:d}])}else{if(_.isObject(d)&&d.items.length){this.trigger("load",[d])}}},onListUpdate:function(){if(this.opened){this.reposition()}},createImportForm:function(){var a=this.buildForm([{type:"form",cssClass:"mwin-form",id:"importHUDForm",items:[{type:"radiobuttonGroup",layout:"inline",label:"Choose preset",options:[{name:"presetType",value:"custom",boxLabel:"Custom",checked:true},{name:"presetType",value:"predefined",boxLabel:"Predefined"}]},{type:"container",id:"customHUDControl",cssClass:"hidden",items:[{type:"textarea",name:"hud_json",label:"",rows:3,hint:'Custom HUD code can be found at *.vhud file. <a href="help/#import" target="help">Learn more</a>'},{type:"checkbox",name:"save_preset",tooltip:"Check this option if you want to be able edit this HUD later without importing code from external file",boxLabel:"Name preset to add it to My HUDs collection",checked:false},{type:"textbox",id:"HUDNameTextbox",cssClass:"hidden",name:"hud_name",label:"",size:32,maxlength:128,value:""}]},{type:"container",cssClass:"hidden mb-10",id:"predefinedHUDPresets",items:{type:"component",constructorName:"visualHUD.Views.SystemHUDPresetList",collection:this.options.presetCollection,scope:this,itemclick:this.importPredefinedHUD}},{type:"container",cssClass:"mb-10 clearfloat",id:"customHUDPresets",items:[{type:"textbox",label:null,placeholder:"Find preset",name:"preset_filter"},{type:"component",constructorName:"visualHUD.Views.CustomHUDPresetList",id:"customHUDList",collection:this.options.customPresetsCollection,scope:this,itemclick:this.importPredefinedHUD},{type:"button",cssClass:"download-presets-button",text:"Download All Presets",name:"downloadPresets"}]},{type:"toolbar",cssClass:"import-form-buttons",items:[{type:"fileInput",text:"Browse For Presets...",accept:".vhud",multiple:true,name:"myCustomPreset",wrap:false},{type:"button",text:"Cancel",action:"reset",role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(a)},createDlPresetForm:function(){var a=this.buildForm([{type:"form",cssClass:"hidden",id:"downloadPresetsForm",action:visualHUD.ACTION_DOWNLOAD_PRESETS,method:"post",items:[{type:"textbox",name:"hud_data",inputType:"hidden",wrap:false}]}]);this.$content.get(0).appendChild(a)},setDlPresetButtonState:function(){this.$downloadPresetsButton=this.$downloadPresetsButton||this.$content.find("button.download-presets-button");var a=this.$downloadPresetsButton;var b=this.options.customPresetsCollection.length==0?"hide":"show";a[b]()},downloadPresets:function(){var a=this.options.customPresetsCollection.toJSON();this.$("#downloadPresetsForm").find("[name=hud_data]").val(JSON.stringify(a));this.$("#downloadPresetsForm").submit()},processSelectedFiles:function(b){var a=Array.prototype.slice.call(b.target.files);if(a.length){visualHUD.Libs.importHelper.batchImport(a,{scope:this,files:function(c){this.trigger("import.text",[c,true])}});this.showCustomHUDPresets()}b.target.value=""}});visualHUD.Views.windows.ImportImage=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"click button[name=setCustomImage]":"setImage","click button[name=cancel]":"hide"},html:(['<div class="mb-20">',"You can use images up to 300Kb in size, supported formats are JPEGs, GIFs and PNGs","</div>"]).join(""),init:function(){var a=this.buildForm([{type:"form",cssClass:"mwin-form",id:"importHUDForm",items:[{type:"fileInput",name:"customImage",label:null,accept:".gif, .png, .jpg, .jpeg",text:"Choose image"},{type:"toolbar",items:[{type:"button",text:"Set Custom Background",role:"main",name:"setCustomImage"},{type:"button",text:"Cancel",role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(a);this.$submitButton=this.$content.find("button[name=setCustomImage]").attr("disabled","disabled");this.$form=this.$content.find("form");this.$fileInput=this.$content.find("input[name=customImage]");this.$fileInput.bind("change",visualHUD.Function.bind(this.handleFileSelect,this));this.on("hide",this.reset,this)},handleFileSelect:function(c){var b=c.target.files[0];if(b){if(visualHUD.Libs.importHelper.checkImageType(b)==false){return this.reset()}if(visualHUD.Libs.importHelper.checkImageSize(b)==false){return this.reset()}var a=new FileReader();a.onload=visualHUD.Function.bind(this.onLoad,this,[b],true);a.readAsDataURL(b)}else{this.$submitButton.attr("disabled",true)}},onLoad:function(b,a){this.$submitButton.attr("disabled",false);this.src=b.target.result},setImage:function(){if(this.src){this.trigger("import",[this.src]);this.src=null;this.hide()}},reset:function(){this.$form.get(0).reset();this.$fileInput.trigger("change");this.$submitButton.attr("disabled",true);return true}});visualHUD.Views.windows.Feedback=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"submit form":"sendReport","focus form":"suppressValidation","blur form":"validate","click button[name=cancel]":"hide"},_html:(['<div class="mb-20">',"<p>Want to help? Send as much details as you can, especially describing your actions. This way I can easely reproduce the problem and fix it. Here is an example of good bug report:</p>",'<blockquote>"I was clicking [Apply] button and get an error message."</blockquote>',"</div>"]).join(""),init:function(){var a=this.buildForm([{type:"form",cssClass:"mwin-form",id:"feedbackForm",action:visualHUD.ACTION_CONTACT,method:"post",items:[{type:"container",cssClass:"row-fluid",items:[{type:"textbox",name:"name",cssClass:"span-6",required:true,label:"Your name",size:32,maxlength:128,value:""},{type:"textbox",name:"email",inputType:"email",cssClass:"span-6",label:"Email address",size:32,maxlength:128,value:""},{type:"textbox",name:"verify",cssClass:"hidden"}]},{type:"textarea",name:"comments",label:"Message",required:true,rows:5,value:""},{type:"toolbar",cssClass:"pt-10",items:[{type:"button",text:"Send",role:"main",action:"submit",name:"submit"},{type:"button",text:"Cancel",role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(a);this.$form=this.$("#feedbackForm");var a=this.$form.get(0);this.on("show",this.setFocus,this);this.on("cancel",this.hide,this);this.on("hide",this.reset,this)},validate:function(a){var b=$(a.target);if(b.get(0).validity){var c="addClass";if(b.get(0).validity.valid==true){c="removeClass"}b[c]("invalid-field")}},suppressValidation:function(a){var b=$(a.target);b.removeClass("invalid-field")},reset:function(){this.$form.get(0).reset();this.$form.find(".invalid-field").removeClass("invalid-field")},sendReport:function(e){var b=this.$form.serializeArray();var a=[];var d=false;var c=this.$form.find("button[type=submit]").attr("disabled",true);$.each(b,function(){if(this.name=="verify"&&this.value.length>0){d=true}if(this.name=="comments"){this.value+="\n---------------\n\n"}});if(d==false){$.ajax({type:this.$form.get(0).method,url:this.$form.get(0).action,data:b,complete:visualHUD.Function.bind(function(k,f,i,j){var h=k.status,g=k.responseText;if(h==200){this.hide();visualHUD.growl.alert({status:"success",title:"Thanks, mate!",message:"Your message has been successfully sent."})}else{this.trigger("update.error",k)}c.attr("disabled",false)},this)})}else{this.hide()}return false},setFocus:function(){this.$el.find("input[name=name]").focus()}});visualHUD.Views.windows.Confirm=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"click button[name=confirm]":"yes","click button[name=cancel]":"no"},html:(['<div class="mb-20" id="messageContainer">',"</div>"]).join(""),defaults:{width:400,height:"auto",confirmButtonText:"OK",cancelButtonText:"Cancel"},init:function(){var b=this.buildForm([{type:"form",cssClass:"mwin-form",id:"importHUDForm",items:[{type:"container",name:"customImage",label:null,text:"Choose image"},{type:"toolbar",items:[{type:"button",text:this.options.confirmButtonText,role:"main",name:"confirm"},{type:"button",text:this.options.cancelButtonText,role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(b);var a=this.$content.find("#messageContainer");a.html(this.options.confirm);this.on("hide",this.destroy,this);this.on("show",function(){this.$content.find("button[name=confirm]").focus()},this)},yes:function(){this.options.handler.apply(this.options.scope||this,[true]);this.hide()},no:function(){this.options.handler.apply(this.options.scope||this,[false]);this.hide()},destroy:function(){this.$el.remove()}});visualHUD.Views.BoundList=Backbone.View.extend({tagName:"ul",className:"bound-list",opened:false,rendered:false,events:{"click .bound-list-item":"itemClick"},defaults:{},renderTo:null,emptyListMessage:"No items here yet",emptyTpl:(['<div class="empty-list-message">',"<%= message %>","</div>"]).join(""),itemTpl:(['<div class="bound-list-item-body">',"<%= name %>","</div>"]).join(""),listItemTpl:'<li class="bound-list-item" data-cid="<%= cid %>"><%= itemHTML %></li>',initialize:function(a){_.extend(this,this.defaults,a||{});if(this.collection){this.bindCollection(this.collection)}if(this.cls){this.$el.addClass(this.cls)}this.bindEvents();this.getRefs();this.init();this.render(this.renderTo)},init:function(){},bindCollection:function(a){this.collection=a;this.collection.on("change",this.updateListItem,this);this.collection.on("add",this.addListItem,this);this.collection.on("remove",this.removeListItems,this);this.collection.on("all",this.refresh,this);this.refresh()},render:function(a){if(a){this.$el.appendTo(this.renderTo);this.rendered=true;this.trigger("render",this)}},getRefs:function(){this.$contentWrapper=this.$el.find("div.xpk-mwindow-wrap");this.$content=this.$el.find("div.xpk-win-content");this.$title=this.$el.find(".xpk-win-head h3");this.$closeButton=this.$el.find(".xpk-close-button");this.$closeButton.click($.proxy(this.hide,this));this.$el.click($.proxy(this.cancelEventBubbling,this))},updateListItem:function(b,a){},addListItem:function(b,a){},removeListItems:function(b,a){},refresh:function(f,b){var d=this,c=[],a=_.template(this.listItemTpl),e=_.template(this.itemTpl);this.$el.children().remove();if(this.collection.length){this.collection.each(function(g){var h=e(g.toJSON());c.push(a({cid:g.cid,itemHTML:h}))})}else{c.push(a({cid:null,itemHTML:_.template(this.emptyTpl,{message:this.emptyListMessage})}))}this.$el.append(c.join(""));this.trigger("refresh",this)},itemClick:function(b){var a=this.getModelByElement(b.currentTarget);this.trigger("itemclick",this,$(b.currentTarget),a,b)},getModelByElement:function(c){var c=$(c),a=c.data("cid"),b=this.collection.getByCid(a);return b},getElementByModel:function(a){var c=a.cid;var b=this.$el.find("[data-cid="+c+"]");return b.length?b:null},bindEvents:function(){if(this.options.itemclick){this.on("itemclick",this.options.itemclick,this.scope||this)}if(this.options.refresh){this.on("refresh",this.options.refresh,this.scope||this)}if(this.options.render){this.on("render",this.options.render,this.scope||this)}},cancelEventBubbling:function(a){a.stopPropagation()}});visualHUD.Views.CustomHUDPresetList=visualHUD.Views.BoundList.extend({cls:"custom-hud-list",collection:null,emptyListMessage:"No presets here yet. Click here to add one",itemTpl:(['<div class="bound-list-item-body">','<span class="item-name"><%= name %></span>','<ul class="custom-hud-actions">','<li class="action icon-download" data-tooltip="Download this HUD" data-action="download"><span>Download this hud</span></li>','<li class="action icon-trash" data-tooltip="Delete" data-action="delete"><span>Delete this hud</span></li>',"</ul>","</div>"]).join(""),emptyTpl:(['<div class="empty-list-message">',"<%= message %>",'<input type="file" name="myCustomPreset" multiple="true" accept=".vhud" />',"</div>"]).join("")});visualHUD.Views.SystemHUDPresetList=visualHUD.Views.BoundList.extend({cls:"custom-hud-list",collection:null,emptyListMessage:"No presets here yet. Click here to add one",itemTpl:(['<div class="bound-list-item-body">','<span class="item-name"><%= name %></span>',"</div>"]).join("")});visualHUD.Widgets.ToolTip=Backbone.View.extend({tagName:"div",className:"hint-wrap",htmlTpl:['<div class="hint-body">','<div class="hint-content"></div>',"</div>",'<div class="hint-corner"></div>'],defaults:{opacity:1,delay:100,width:200},VERTICAL_OFFSET:5,rendered:false,initialize:function(a){this.$el.append(this.htmlTpl.join(""));$(document.body).on("click.hideTooltip",visualHUD.Function.bind(this.hide,this));$(document.body).on("mouseenter","[data-tooltip]",visualHUD.Function.bind(this.mover,this));$(document.body).on("mouseleave","[data-tooltip]",visualHUD.Function.bind(this.mout,this));this.options=_.extend({},this.defaults,a||{});this.bound={show:visualHUD.Function.createBuffered(this.show,this.options.delay,this)};this.getDOMRefs()},render:function(){this.$el.appendTo(document.body);this.rendered=true},getDOMRefs:function(){this.$content=this.$el.find("div.hint-content");this.$body=this.$el.find("div.hint-body")},mover:function(a){if(this.disabled){return}this.$activeElement=$(a.currentTarget);window.clearTimeout(this.showTimer);this.showTimer=this.bound.show();this.mouseOver=1},mout:function(a,b){if(this.disabled){return}window.clearTimeout(this.showTimer);this.mouseOver=0;this.hide()},show:function(c){if(this.rendered==false){this.render()}if(this.$activeElement==null){return}var d=this.$activeElement.data("tooltip");if(d==null||d==""||this.mouseOver==0){return}this.$content.css("visibility","hidden").html(d);this.$el.css({width:"",top:0,left:0});this.$body.css({width:"",height:""});var b=this.$body.width();var a=this.$body.height();if(b>this.options.width){this.$body.css({width:this.options.width});b=this.options.width;a=this.$body.height()}this.setTipPosition();this.$body.css({width:0,height:0,opacity:0});this.$el.css({width:this.options.width,visibility:"visible"});visualHUD.Function.createBuffered(this.animate,10,this,[b,a])()},animate:function(b,a){this.$body.animate({width:b+2,height:a+2,opacity:this.options.opacity},{duration:100,complete:visualHUD.Function.createDelayed(function(){this.$content.css("visibility","")},20,this)})},hide:function(){if(!this.$activeElement){return}this.$content.css("visibility","hidden");this.$el.css({visibility:"hidden",bottom:"auto",top:-1000,left:-1000});this.$activeElement=null},getElementPosition:function(b){var c=this.$activeElement.get(0);var a=this.$activeElement.offset();var d={width:c.offsetWidth,height:c.offsetHeight,left:a.left,top:a.top};d.right=d.left+d.width;d.bottom=d.top+d.height;return d},setTipPosition:function(){var a=this.getElementPosition();var b=$(document.body).innerHeight();var d=a.top-this.$el.height()-this.VERTICAL_OFFSET;var c=b-a.top+this.VERTICAL_OFFSET;if(d<0){c="auto";d=a.bottom+this.VERTICAL_OFFSET;this.$el.addClass("hint-carret-top").removeClass("hint-carret-bottom")}else{d="auto";this.$el.addClass("hint-carret-bottom").removeClass("hint-carret-top")}this.$el.css({top:d,left:"auto",bottom:c,left:a.left-this.options.width/2+a.width/2})},disable:function(){window.clearTimeout(this.showTimer);this.hide();this.disabled=1},enable:function(){this.disabled=0}});visualHUD.Widgets.PopOver=Backbone.View.extend({tagName:"div",className:"popover-wrap",htmlTpl:['<div class="popover-body">','<div class="popover-title"><%= title %></div>','<div class="popover-content"><%= html %></div>',"</div>"],defaults:{cls:"",opacity:1,maxWidth:500,offset:10,cancelEventBubbling:true,html:"This is popover content",title:"Pop Over",position:"top-left",trigger:"hover"},currentPosition:null,events:{click:"cancelEventBubbling"},disabled:false,visible:false,initialize:function(a){var b=_.template(this.htmlTpl.join(""));this.options=_.extend({},this.defaults,a||{});this.$corner=$('<div class="popover-corner"></div>');this.$el.append(b(this.options));this.$corner.css("display","none");this.$el.css("display","none");if(this.options.cls){this.$el.addClass(this.options.cls)}this.bindEvents();this.getDOMRefs();this.render()},render:function(){this.$corner.appendTo(document.body);this.$el.appendTo(document.body);this.trigger("render",this)},bindEvents:function(){if(this.options.render){this.on("render",this.options.render,this.options.scope||this)}if(this.options.show){this.on("show",this.options.show,this.options.scope||this)}if(this.options.hide){this.on("hide",this.options.hide,this.options.scope||this)}},getDOMRefs:function(){this.$content=this.$el.find("div.popover-content");this.$title=this.$el.find("div.popover-title");this.$body=this.$el.find("div.popover-body")},setContend:function(a){this.$content.html(a);return this},setTitle:function(a){this.$title.html(a);return this},show:function(b,c){if(this.disabled){return}this.$activeElement=$(b);if(this.currentPosition!=null){this.$el.removeClass(this.currentPosition);this.$corner.removeClass(this.currentPosition)}this.$el.addClass("fade").css("display","block");this.$corner.addClass("fade").css("display","block");var d=this.getCoordinates();var a=this.getCornerCoordinates();this.$el.css(d).addClass("in");this.$corner.addClass(this.currentPosition).css(a).addClass("in");c&&c.stopPropagation();$("body").bind("click.hidePopOver",visualHUD.Function.bind(this.hide,this));this.visible=true;this.trigger("show",this);$(document).bind("mousewheel.hidePopover",visualHUD.Function.bind(this.hide,this));$(window).bind("resize.hidePopover",visualHUD.Function.bind(this.hide,this))},hide:function(){if(!this.$activeElement){return false}this.$corner.removeClass("in").css("display","none");this.$el.removeClass("in").css("display","none");this.$activeElement=null;$("body").unbind("click.hidePopOver");this.visible=false;this.trigger("hide",this);$(document).unbind("mousewheel.hidePopover");$(window).unbind("resize.hidePopover",visualHUD.Function.bind(this.hide,this))},positionsMaps:{vertical:["bottom-right","bottom-center","bottom-left","top-left","top-center","top-right"],horizontal:["right-top","right-center","right-bottom","left-bottom","left-center","left-top"]},getCoordinates:function(){var a=this.$activeElement.coordinates(false,true);var b=this.$el.coordinates();var c=this.options.position.split("-").shift();var e=(/top|bottom/).test(c);var d=(/left|right/).test(c);return this.calcCoordinates(this.options.position,{direction:e?"vertical":"horizontal",maxLeft:$(document.body).innerWidth(),maxTop:$(document.body).innerHeight(),popOverCoordinates:b,targetElementCoordinates:a})},calcCoordinates:function(f,j){var e=this.positionsMaps[j.direction],a=_.indexOf(e,f),k=f.split("-").shift(),b=f.split("-").pop();var g=j.targetElementCoordinates.top;var c=j.targetElementCoordinates.left;var i=j.popOverCoordinates.height,h=j.popOverCoordinates.width;this.$el.addClass(this.currentPosition);switch(k){case"top":g-=i+this.options.offset;break;case"bottom":g=j.targetElementCoordinates.bottom+this.options.offset;break;case"left":c-=h+this.options.offset;break;case"right":c=j.targetElementCoordinates.right+this.options.offset;break}switch(b){case"bottom":g-=(i-j.targetElementCoordinates.height);break;case"right":c-=(h-j.targetElementCoordinates.width);break;case"center":if(j.direction=="vertical"){c-=h/2-j.targetElementCoordinates.width/2}else{g-=i/2-j.targetElementCoordinates.height/2}break}if((g<0||g+i>j.maxTop||c<0||c+h>j.maxLeft)==true){this.$el.removeClass(this.currentPosition);var d=e[a+1]||e[0];return this.calcCoordinates(d,j)}else{this.currentPosition=f;return{top:g,left:c}}},getCornerCoordinates:function(){var b=this.$activeElement.coordinates(false,true);var d=this.currentPosition.split("-").shift();var f=b.top;var e=b.left;var c=this.$corner.outerWidth();var a=this.$corner.outerHeight();switch(d){case"top":f-=a;e+=b.width/2-c/2;break;case"bottom":f=b.bottom;e+=b.width/2-c/2;break;case"left":f+=b.height/2-a/2;e-=c;break;case"right":f+=b.height/2-a/2;e=b.right;break}return{top:f,left:e}},disable:function(){this.hide();this.disabled=1},enable:function(){this.disabled=0},cancelEventBubbling:function(a){if(this.options.cancelEventBubbling==true){a.stopPropagation()}}});visualHUD.Widgets.Growl=Backbone.View.extend({tagName:"div",className:"growl-message-container",msgTpl:['<div class="growl-message-wrapper clearfloat">','<div class="growl-message">','<a class="close-message">&times;</a>','<div class="message">',"<% if(title) { %>","<h4><%= title %></h4>","<% } %>","<div><%= message %></div>","</div>","</div>","</div>"],active:0,stack:[],messageLog:[],messagesCounter:0,defaults:{speed:300,delay:50000,offset:10,status:"working",fixed:false,single:false,maxMessages:8,className:"growl-message-container",position:"bottom-right"},defaultMessageOptions:{title:null,message:"This is growl message",status:null},currentPosition:null,events:{"click a.close-message":"hideMessage","contextmenu div.growl-message-wrapper":"hideMessage"},disabled:false,visible:false,rendered:false,initialize:function(a){this.options=_.extend({},this.defaults,a||{});this.$el.css({margin:this.options.offset}).addClass(this.options.position);this.bindEvents()},render:function(){this.$el.appendTo(document.body);this.rendered=true;this.trigger("render",this)},bindEvents:function(){if(this.options.render){this.on("render",this.options.render,this.options.scope||this)}if(this.options.show){this.on("show",this.options.show,this.options.scope||this)}if(this.options.hide){this.on("hide",this.options.hide,this.options.scope||this)}},getDOMRefs:function(){},alert:function(a){if(this.rendered==false){this.render()}if(this.options.single){this.$el.children().remove()}this.$el.show();var a=_.extend({},this.defaultMessageOptions,a);var b=_.template(this.msgTpl.join(""),a);var c=$(b).addClass(a.status||this.options.status).css("display","none");var f=this.options.position.split("-").shift();var e=f=="bottom"?"prependTo":"appendTo";var d=visualHUD.Function.createDelayed(this.hide,a.delay||this.options.delay,this,[c]);this.$messages=this.$el.children();if(this.$messages.length>this.options.maxMessages){this.hide(this.$messages.eq(0))}c[e](this.$el).fadeTo(this.options.speed,1);d();this.trigger("show",[this]);return c},hide:function(a){var b=this;if(a){a.find(".growl-message").hide(this.options.speed/2,function(){a.remove();if(b.$el.children().length==0){b.$el.hide()}})}else{$messages.remove();this.$el.hide()}this.trigger("hide",[this]);return this},hideMessage:function(b){var c=$(b.currentTarget);var a=c.closest(".growl-message-wrapper",this.$el);if(a.length){this.hide(a)}return false}});visualHUD.Controllers.HUDManager=Backbone.Controller.extend({views:["HUDItem","HUDItemForm"],models:["HUDItem","ClientSettings"],collections:["HUDItemTemplates","HUDItemIconEnums","HUDItems","CustomHUDPresets"],AUTOSAVE_TIMEOUT:300000,initialize:function(a){this.on({Viewport:{"import.image":this.importImage,"load.text":this.loadHUDFile},"viewport.TopBar":{"align.action":this.alignItems,"toolbar.hud:action":this.groupActions,"load.text":this.loadHUDFile},"viewport.StageControls":{"item.drop":this.dropNewHUDItem},"viewport.Canvas":{"drop.move":this.onItemMove},"windows.ImportHUD":{load:this.loadHUD,"download.preset":this.downloadPreset,"import.text":this.importHUDPresets},"windows.Download":{download:this.onDownload},"windows.ImportImage":{"import":this.importImage},Form:{"align.action":this.alignItems,"arrange.action":this.arrangeItems},HUDItem:{click:this.onHUDItemClick,destroy:this.onHUDItemDestroy},keyboard:{"select.all":this.selectAllHUDItems,"delete":this.deleteSelectedItems,move:this.moveSelectedItems,group:this.groupSelectedItems,clone:this.cloneSelectedItems,arrange:this.arrangeItems}})},onLaunch:function(){var b=this.getCollection("HUDItems");var c=this.getModel("ClientSettings");c.on("change",this.updateHUDItemStatus,this);b.on("add",this.addNewHUDItem,this);b.on("load",this.loadDraft,this);var a=this.getApplicationView("Viewport");$(window).load(function(){b.load();$("body").addClass("loading");a.$el.addClass("animate-viewport");$("#preloader").fadeOut(400,function(){$(this).remove();$("body").removeClass("loading");window.setTimeout(function(){a.$el.removeClass("animate-viewport")},550)})})},loadDraft:function(){if(this.getCollection("HUDItems").length==0){return this.showGetStartedMessage()}var b=this.getApplicationView("viewport.Canvas"),a=[];b.beginUpdate();this.selectAllHUDItems();this.deleteSelectedItems();this.getCollection("HUDItems").each(function(c){var f=this.getModel("ClientSettings").getStatusByName(c.get("name"));(f)&&c.set("text",f,{silent:true});try{this.createNewHUDItem(c)}catch(d){a.push(c);console.warn("Invalid HUD Data!",c.toJSON())}},this);if(a.length){console.warn(_.template(visualHUD.messages.HUD_ELEMENTS_PARSE_ERROR,{count:a.length}));this.getCollection("HUDItems").remove(a)}b.completeUpdate()},showGetStartedMessage:function(){var b=window.sessionStorage.getItem("_vhud_getStartedMessage_shown");if(b!=null){return}else{window.sessionStorage.setItem("_vhud_getStartedMessage_shown",true)}var a=this.application.growl.alert({status:"info",title:"Get Started",delay:20000,message:(["<p>Visual HUD is ready to rock, but there are no HUD items yet. Would you like to import something?</p>",'<a href="#" class="import">Import HUD</a>']).join("")});a.find("a.import").click(visualHUD.Function.bind(function(){var c=this.getApplicationView("windows.ImportHUD");if(this.getCollection("CustomHUDPresets").length>0){c.importCustom()}else{c.importPredefined()}this.application.growl.hide(a);return false},this))},dropNewHUDItem:function(b,a){var d=this.getModelConstructor("HUDItem");var c=new d();var e=this.getModel("ClientSettings").getStatusByName(b.get("id"));c.setDefaultValues({name:b.get("id"),itemType:b.get("itemType")}).set({cssClass:b.get("cssClass"),label:b.get("label"),coordinates:a});c.wasDropped=true;if(e){c.set("text",e)}this.getCollection("HUDItems").add(c)},createNewHUDItem:function(g){var j=this.getCollection("HUDItemTemplates");var k=this.getApplicationView("viewport.Canvas");var b=this.getApplicationView("Viewport");var c=b.getStageControlsView();var d=j.get(g.get("name"));if(!d){return null}var h=this.getViewConstructor("HUDItem");var a=this.getViewConstructor("HUDItemForm");var e=this.getCollection("HUDItemIconEnums");var i=new a({alias:"Form",model:g,renderTo:b.$sidebarArea,collections:{HUDItemIconEnums:e}});var f=new h({alias:"HUDItem",HUDItemIconEnums:e,renderTo:k.$canvas,model:g,wasDropped:g.wasDropped,formView:i,htmlTplRecord:d});c.updateControlsStatus("create",g.get("name"));delete g.wasDropped;return f},addNewHUDItem:function(a){var c=this.getApplicationView("viewport.Canvas");var b=this.createNewHUDItem(a);if(b==null){a.destroy()}else{c.select(b,false)}},onItemMove:function(a){var b=this.getApplicationView("viewport.Canvas");_.each(b.getSelection(),function(c){c.refreshCoordinates()});b.disableSelection()},onHUDItemClick:function(a,b){var c=this.getApplicationView("viewport.Canvas");this.application.getController("FocusManager").blur();c.select(a,b.shiftKey||b.ctrlKey);c.enableSelection()},onHUDItemDestroy:function(b){var c=this.getApplicationView("Viewport"),a=c.getStageControlsView();a.updateControlsStatus("destroy",b.get("name"))},updateHUDItemStatus:function(a,d){var c=d.changes;var b=this.getCollection("HUDItems");_.each(c,function(i,h){var g=a.get(h),f,e="text";switch(h){case"statusHealth":f=/healthIndicator|healthBar/;break;case"statusArmor":f=/armorIndicator|armorBar/;break;case"statusAmmo":f=/ammoIndicator/;break;case"statusAccuracy":f=/accuracyIndicator/;break;case"statusSkill":f=/skillIndicator/;break;case"ownerDrawFlag":return b.filterItemsByOwnerDraw(g)}b.each(function(j){var k=j.get("name");if(f&&f.test(k)){j.set(e,g)}})},this)},alignItems:function(a){var b=this.getApplicationView("viewport.Canvas");visualHUD.Libs.layersManager.alignEdges(b,a);_.each(b.getSelection(),function(c){c.refreshCoordinates()})},arrangeItems:function(a){var b=this.getApplicationView("viewport.Canvas");visualHUD.Libs.layersManager.arrangeLayers(b,a);b.updateIndexes();this.getCollection("HUDItems").sort()},groupActions:function(a){switch(a){case"deleteSelected":this.deleteSelectedItems();break;case"groupSelected":this.groupSelectedItems();break;case"cloneSelected":this.cloneSelectedItems();break;case"undoUpdate":this.application.getController("HistoryManager").undo();break}},selectAllHUDItems:function(b){var a=this.getApplicationView("viewport.Canvas");a.selectAll()},deleteSelectedItems:function(){var a=this.getApplicationView("viewport.Canvas"),b=a.getSelection();if(this.getCollection("HUDItems").length==b.length){this.getModel("ClientSettings").set("HUDName",null)}_.each(b,function(c){c.model.destroy()});a.deselect()},moveSelectedItems:function(c,d){var a=this.getApplicationView("viewport.Canvas"),b=a.getSelection();_.each(b,function(e){e.move(c,d)})},groupSelectedItems:function(){var b=this.getApplicationView("viewport.Canvas"),c=b.getSelection(),a=c[0];isUngroup=false,groupGuid=null;_.each(c,function(d){if(d.getGroup()){isUngroup=true}else{groupGuid=groupGuid||visualHUD.Libs.utility.getGuid()}d.setGroup(groupGuid)});if(isUngroup==true){b.deselect();b.select(a)}},cloneSelectedItems:function(c){var d=this.getApplicationView("viewport.Canvas"),b=Array.prototype.slice.call(d.getSelection()),a=this.getModelConstructor("HUDItem");d.deselect();_.each(b,function(e){var g=e.model.toJSON();_.extend(g,{group:null,coordinates:{top:g.coordinates.top+10,left:g.coordinates.left+10}});var f=new a(g),h=this.createNewHUDItem(f);this.getCollection("HUDItems").add(f,{silent:true});d.select(h,true)},this)},loadHUD:function(b,a,c){var a=b.name||a;if(_.isArray(b)){b={name:a,items:b}}if(a){this.addCustomHUDPreset(b)}else{this.getModel("ClientSettings").set("HUDName",null)}if(this.getCollection("HUDItems").length&&c!==true){visualHUD.confirm({title:"Overwrite Current HUD?",confirm:visualHUD.messages.CONFIRM_HUD_OVERWRITE,confirmButtonText:"Yes, overwrite",scope:this,handler:function(d){this.getCollection("HUDItems").load(b.items)}})}else{this.getCollection("HUDItems").load(b.items)}},onDownload:function(a,c){var b=a.serializeForm();if(b.save_preset){this.addCustomHUDPreset({name:c.name,items:a.collection.toJSON()})}else{this.getModel("ClientSettings").set("HUDName",null)}},downloadPreset:function(b){var a=this.getApplicationView("windows.Download");a.setHUDData(b);a.getForm().submit()},syncPresets:function(){var a=this.getModel("ClientSettings").get("HUDName");if(a){this.addCustomHUDPreset({name:a,items:this.getCollection("HUDItems").toJSON()})}},addCustomHUDPreset:function(e){var b=e.items,c=e.name,d=e.isBuiltIn;if(d===true){return}var a=this.getCollection("CustomHUDPresets").find(function(f){return f.get("name")==c});if(a){a.set("items",b)}else{this.getCollection("CustomHUDPresets").add(e)}this.getModel("ClientSettings").set("HUDName",c)},importImage:function(b){var a=this.getModel("ClientSettings");a.set({customBackground:b,canvasShot:3});this.getApplicationView("viewport.CanvasToolbar").setClientSettings({canvasShot:3})},importHUDPresets:function(e,f){var h=true,i=this.getApplicationView("windows.ImportHUD"),a=i?i.opened==false:true,c=this.getCollection("HUDItems").length;_.each(e,function(l,k){try{var n=true;if(f===true){n=false}else{if(k==0){n=c>0}}this.loadHUD(JSON.parse(l.json),l.name||null,n)}catch(m){h=false;console.error("Failed to import HUD",l.json)}},this);if(h&&!f){var j="<%= count %> HUD<%= count==1 ? ' has' : 's have' %> been successfuly imported! ";if(a==true){j=["<p>",j,"Would you like to review the new items?","</p>",'<a href="#" class="import">Open import manager</a>']}else{j=[j]}var d=this.application.growl,b=this.application.getController("Viewport");var g=d.alert({title:"Hooray! ",status:"success",message:_.template(j.join(""),{count:e.length})});g.find("a.import").click(visualHUD.Function.bind(function(){b.loadPreset();d.hide(g);return false},this))}},loadHUDFile:function(b,a){_.each(b,function(d,c){try{this.loadHUD(JSON.parse(d.json),d.name||null,c>0)}catch(f){success=false;console.error("Failed to import HUD",d.json)}},this)}});visualHUD.Controllers.KeyboardManager=Backbone.Controller.extend({keyCodeMap:{A:65,V:86,Z:90,TAB:9,F:70,LEFT:37,TOP:38,RIGHT:39,DOWN:40,C:67,D:68,I:73,DEL:46,R:82,G:71},moveCodeMap:{"37":"left","38":"top","39":"left","40":"top"},initialize:function(a){$(document).bind("keydown",$.proxy(this,"keyboardListiner"))},keyboardListiner:function(a){var f=a.target.nodeName;if(f.match(/input|select|textarea|button|checkbox|radiobutton/gi)){return}if(a.keyCode==this.keyCodeMap.D){this.trigger("keyboard","download");return false}if(a.keyCode==this.keyCodeMap.I){this.trigger("keyboard","import");return false}if(a.keyCode==this.keyCodeMap.R&&a.ctrlKey&&a.shiftKey){var c=window.confirm(visualHUD.messages.CONFIRM_APPLICATION_RESET);if(c==true){this.trigger("keyboard","reset")}return c}if(a.keyCode==this.keyCodeMap.DEL){this.trigger("keyboard","delete");return false}if(a.keyCode==this.keyCodeMap.TAB){this.trigger("keyboard","fullscreen.toggle",[a]);return false}if(a.keyCode==this.keyCodeMap.V&&a.ctrlKey){this.trigger("keyboard","clone",[a]);return false}if(a.keyCode==this.keyCodeMap.Z&&a.ctrlKey){this.trigger("keyboard","undo",[a]);return false}if(this.isArrangeKeyPressed(a)&&a.ctrlKey){var b=this.getArrangeAction(a);this.trigger("keyboard","arrange",[b]);return false}if(this.isMoveKeyPressed(a.keyCode)){var e=this.getMoveDelta(a);var d=this.getMoveDirection(a.keyCode);this.trigger("keyboard","move",[d,e]);return false}if(a.keyCode==this.keyCodeMap.A&&a.ctrlKey){this.trigger("keyboard","select.all",[a]);return false}if(a.keyCode==this.keyCodeMap.G&&a.ctrlKey){a.stopPropagation();a.preventDefault();this.trigger("keyboard","group",[a]);return false}},isMoveKeyPressed:function(a){return _.include([this.keyCodeMap.TOP,this.keyCodeMap.LEFT,this.keyCodeMap.DOWN,this.keyCodeMap.RIGHT],a)},getMoveDirection:function(a){return this.moveCodeMap[a]},getMoveDelta:function(a){var b=1*visualHUD.scaleFactor;if(a.keyCode==this.keyCodeMap.LEFT||a.keyCode==this.keyCodeMap.TOP){b*=-1}if(a.shiftKey){b*=10}return b},isArrangeKeyPressed:function(a){return _.include([this.keyCodeMap.TOP,this.keyCodeMap.DOWN],a.keyCode)},getArrangeAction:function(d){var c={"38":["bring-front","bring-forward"],"40":["send-back","send-backward"]};var a=c[d.keyCode];var b=d.shiftKey?0:1;return a[b]}});visualHUD.Controllers.FocusManager=Backbone.Controller.extend({initialize:function(a){this.focusedItem=null},onLaunch:function(){var a=this.getApplicationView("Viewport");$(document).on("focus","form",$.proxy(this,"focusListener"))},focusListener:function(a){var b=a.target.nodeName;if(b.match(/input|select|textarea|button|checkbox|radiobutton/gi)){this.focusedItem=a.target}},getFocused:function(){return this.focusedItem},blur:function(){this.focusedItem&&this.focusedItem.blur()}});visualHUD.Controllers.Viewport=Backbone.Controller.extend({views:["Viewport","viewport.CanvasToolbar","viewport.Canvas","viewport.TopBar","viewport.StageControls","GroupActionsPanel","windows.Download","windows.ImportHUD","windows.ImportImage","windows.Feedback","windows.Confirm"],models:["ClientSettings","HUDItem"],collections:["StageControlsDictionary","HUDItemTemplates","HUDItemIconEnums","HUDItems","HUDPresets"],initialize:function(a){this.on({Viewport:{render:this.onViewportRender},"viewport.CanvasToolbar":{"toolbar.menu:show":this.onCanvasMenuShow,"toolbar.menu:hide":this.onCanvasMenuHide,"import.image":this.importImage},"viewport.TopBar":{"toolbar.global:action":this.toolbarAction,"feedback.action":this.feedbackAction},"viewport.Canvas":{selectionchange:visualHUD.Function.createBuffered(this.onSelectionChange,50,this),"import.image":this.importImage},"viewport.StageControls":{"scalefactor.change":this.switchScaleFactor,"layout.change":this.toggleFullscreen},keyboard:{"fullscreen.toggle":this.toggleFullscreen,reset:this.resetApplication,"import":this.loadPreset,download:this.downloadHUD}})},onLaunch:function(){var c=this.getModel("ClientSettings");var a=this.createApplicationView("Viewport",{clientSettingsModel:c});var d=this.createApplicationView("viewport.CanvasToolbar",{clientSettingsModel:c});var b=this.createApplicationView("viewport.Canvas",{clientSettingsModel:c});var f=this.createApplicationView("viewport.TopBar");var e=this.createApplicationView("viewport.StageControls",{collection:this.getCollection("StageControlsDictionary")});this.createApplicationView("windows.Download",{width:600,title:"Download HUD",collection:this.getCollection("HUDItems")});this.createApplicationView("windows.ImportHUD",{width:600,title:"Import HUD",customPresetsCollection:this.getCollection("CustomHUDPresets"),presetCollection:this.getCollection("HUDPresets")});d.render(a);b.render(a);f.render(a);e.render(a);a.render([d,b,f,e])},onViewportRender:function(a){},importImage:function(){if(!this.getApplicationView("windows.ImportImage")){this.createApplicationView("windows.ImportImage",{width:600,title:"Import Custom Background"})}this.getApplicationView("windows.ImportImage").show()},toolbarAction:function(b){var a=this[b];if(_.isFunction(a)){a.apply(this,arguments)}},feedbackAction:function(a){if(!this.getApplicationView("windows.Feedback")){this.createApplicationView("windows.Feedback",{width:600})}switch(a){case"send-feedback":this.sendFeedback();break;case"report-bug":this.reportBug();break}},downloadHUD:function(){var a=this.getCollection("HUDItems");var c=this.getModel("ClientSettings").get("HUDName");var d=this.getCollection("CustomHUDPresets").find(function(e){return e.get("name")===c});if(!this.getApplicationView("windows.Download")){}if(a.length>0){this.getApplicationView("windows.Download").setSavePresetCheckboxLabel(d!=null).setHUDName(c).show()}else{var b=this.application.growl.alert({title:"Oops ;(",status:"warning",message:(["<p>",visualHUD.messages.EMPTY_HUD_WARNING,"</p>",'<a href="#" class="import">Import now</a>']).join("")});b.find("a.import").click(visualHUD.Function.bind(function(){this.loadPreset();this.application.growl.hide(b);return false},this))}},loadPreset:function(){this.getApplicationView("windows.ImportHUD").show()},restartApplication:function(){window.location.reload()},reportBug:function(){this.getApplicationView("windows.Feedback").setTitle("Report an Application Error");this.getApplicationView("windows.Feedback").show()},sendFeedback:function(){if(!this.getApplicationView("windows.Feedback")){this.createApplicationView("windows.Feedback",{width:600})}this.getApplicationView("windows.Feedback").setTitle("Give a Feedback");this.getApplicationView("windows.Feedback").show()},onSelectionChange:function(a,b){this.getApplicationView("Viewport").hideAllSidebarItems();if(b.length==1){b[0].getForm().show()}else{this.getApplicationView("viewport.StageControls").show();this.application.getController("FocusManager").blur()}this.getApplicationView("viewport.TopBar").updateToolbarButtonsState(b.length)},onCanvasMenuShow:function(){this.getApplication().toolTips.disable()},onCanvasMenuHide:function(){this.getApplication().toolTips.enable()},toggleFullscreen:function(a){var c=this.getModel("ClientSettings"),b=!c.get("fullScreenView");if(typeof a=="boolean"){b=a}c.set("fullScreenView",b);if(b==false){this.getApplicationView("viewport.CanvasToolbar").hideMenu()}},switchScaleFactor:function(a){$("body").removeClass("scale-factor-"+this.application.scaleFactor);this.getCollection("HUDItems").save();this.application.scaleFactor=a;this.getModel("ClientSettings").set("scaleFactor",a);this.getCollection("HUDItems").reset();$("body").addClass("scale-factor-"+a);this.getCollection("HUDItems").load()},resetApplication:function(){this.getModel("ClientSettings").reset();this.getCollection("CustomHUDPresets").reset();this.getCollection("HUDItems").reset();this.restartApplication()}});visualHUD.Controllers.HistoryManager=Backbone.Controller.extend({HISTORY_LENGTH:50,EXCLUDE_FIELDS:/index|group/gi,initialize:function(a){this.undoHistrory=[];this.redoHistrory=[];this.on({keyboard:{undo:this.undo}})},onLaunch:function(){this.getCollection("HUDItems").on("change",this.pushUpdateState,this);this.getCollection("HUDItems").on("remove",this.pushDestroyState,this);this.getCollection("HUDItems").on("add",this.pushCreateState,this);this.getCollection("HUDItems").on("load",this.clearHistory,this)},clearHistory:function(){this.undoHistrory.length=0},pushUpdateState:function(b,c){var a=_.keys(c.changes);a=_.filter(a,function(d){return d.match(this.EXCLUDE_FIELDS)==null},this);if(b.wasDropped!==true&&a.length>0){this.pushHistoryState({event:"update",cid:b.cid,model:b,fields:a,state:b.previousAttributes()})}},pushCreateState:function(a,c,b){this.pushHistoryState({event:"create",cid:a.cid,model:a,fields:null,state:null})},pushDestroyState:function(a,c,b){this.pushHistoryState({event:"destroy",cid:a.cid,model:a.toJSON(),fields:null,state:null})},pushHistoryState:function(a){this.undoHistrory.push(a);if(this.undoHistrory>this.HISTORY_LENGTH){this.undoHistrory.shift()}},undo:function(){var a=this.undoHistrory.pop();if(a){switch(a.event){case"update":this.undoUpdate(a);break;case"create":this.undoCreate(a);break;case"destroy":this.undoDestroy(a);break}}},undoUpdate:function(d){this.getCollection("HUDItems").off("change",this.pushUpdateState,this);var a=d.model,c=a._HUDItem,b={};_.each(d.fields,function(e){b[e]=d.state[e]});c.update(b);this.getCollection("HUDItems").on("change",this.pushUpdateState,this)},undoCreate:function(b){var a=this.getApplicationView("viewport.Canvas");this.getCollection("HUDItems").off("remove",this.pushDestroyState,this);b.model.destroy();this.getCollection("HUDItems").on("remove",this.pushDestroyState,this);a.deselect()},undoDestroy:function(c){var d=this.getApplicationView("viewport.Canvas"),b=this.getModelConstructor("HUDItem"),a=new b(c.model);this.getCollection("HUDItems").add(a);this.undoHistrory.pop();_.each(this.undoHistrory,function(e){if(e.cid==c.cid){e.model=a}})},redo:function(){}});